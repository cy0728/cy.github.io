<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>React | 小逸的博客</title><meta name="description" content="1. React简介1.1 React介绍 React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。  React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东"><meta name="author" content="小逸"><meta name="copyright" content="小逸"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/logo.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="React"><meta name="twitter:description" content="1. React简介1.1 React介绍 React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。  React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东"><meta name="twitter:image" content="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2035944494,3453366933&amp;fm=26&amp;gp=0.jpg"><meta property="og:type" content="article"><meta property="og:title" content="React"><meta property="og:url" content="http://yoursite.com/2019/09/27/React/"><meta property="og:site_name" content="小逸的博客"><meta property="og:description" content="1. React简介1.1 React介绍 React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。  React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东"><meta property="og:image" content="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2035944494,3453366933&amp;fm=26&amp;gp=0.jpg"><meta property="article:published_time" content="2019-09-26T16:00:00.000Z"><meta property="article:modified_time" content="2020-04-28T02:47:35.596Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2019/09/27/React/"><link rel="prev" title="Create-React-App" href="http://yoursite.com/2019/10/20/Create-React-App/"><link rel="next" title="Vue" href="http://yoursite.com/2019/09/06/Vue/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="小逸的博客" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-React简介"><span class="toc-number">1.</span> <span class="toc-text">1. React简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-React介绍"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 React介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-前端三大主流框架"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 前端三大主流框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-React与Vue的对比"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 React与Vue的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-React中几个核心的概念"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 React中几个核心的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1-虚拟DOM（Virtual-Document-Object-Model）"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.4.1 虚拟DOM（Virtual Document Object Model）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2-react的Diff算法"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2 react的Diff算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-tree-diff"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">a) tree diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-component-diff"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">b) component diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-element-diff"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">c) element diff</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-React入门案例"><span class="toc-number">2.</span> <span class="toc-text">2. React入门案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-创建webpack应用"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 创建webpack应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-在webpack中使用-react"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 在webpack中使用 react</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-JSX语法"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 JSX语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-启用-JSX-语法"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 启用 JSX 语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-JSX-语法"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 JSX 语法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-React中创建组件"><span class="toc-number">3.</span> <span class="toc-text">3. React中创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-使用构造函数来创建组件"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 使用构造函数来创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-创建组件"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 创建组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-为组件传递数据"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 为组件传递数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-封装组件到独立文件"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.3 封装组件到独立文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-使用-class-关键字来创建组件"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 使用 class 关键字来创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-ES6的class关键字"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 ES6的class关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-class继承"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 class继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-基于class关键字创建组件"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 基于class关键字创建组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-state的修改"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4 state的修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-不能直接修改-State"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">a) 不能直接修改 State</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-State的更新可能是异步的"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">b) State的更新可能是异步的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-获取更新之后的state数据"><span class="toc-number">3.2.4.3.</span> <span class="toc-text">c) 获取更新之后的state数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-setState的实现过程"><span class="toc-number">3.2.4.4.</span> <span class="toc-text">d) setState的实现过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-两种创建组件方式的对比"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 两种创建组件方式的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-条件渲染"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 条件渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-通过if来进行条件渲染"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 通过if来进行条件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-通过-amp-amp-进行条件渲染"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 通过&amp;&amp;进行条件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-三元运算符条件渲染"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.4.3 三元运算符条件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-4-阻止组件渲染"><span class="toc-number">3.4.4.</span> <span class="toc-text">3.4.4 阻止组件渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-列表渲染"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 列表渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-Fragment的使用"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 Fragment的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-React组合"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 React组合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-评论列表案例"><span class="toc-number">4.</span> <span class="toc-text">4. 评论列表案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-案例完成"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 案例完成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-使用CSS样式表"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 使用CSS样式表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-使用CSS模块化"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 使用CSS模块化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-CSS模块化注意事项"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 CSS模块化注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-Bootstrap样式的使用"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 Bootstrap样式的使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-webpack配置详解"><span class="toc-number">5.</span> <span class="toc-text">5.webpack配置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-开发环境配置"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 开发环境配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-生产环境配置文件"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 生产环境配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-创建生产环境的配置文件"><span class="toc-number">5.2.1.</span> <span class="toc-text">a) 创建生产环境的配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-每次重新构建时候删除dist目录"><span class="toc-number">5.2.2.</span> <span class="toc-text">b) 每次重新构建时候删除dist目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-分离第三方包"><span class="toc-number">5.2.3.</span> <span class="toc-text">c) 分离第三方包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#d-优化压缩HTML文件"><span class="toc-number">5.2.4.</span> <span class="toc-text">d) 优化压缩HTML文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#e-抽取bundle-js中的CSS到指定文件"><span class="toc-number">5.2.5.</span> <span class="toc-text">e) 抽取bundle.js中的CSS到指定文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#f-压缩抽取出来的CSS文件"><span class="toc-number">5.2.6.</span> <span class="toc-text">f) 压缩抽取出来的CSS文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#g-生产环境配置文件总结"><span class="toc-number">5.2.7.</span> <span class="toc-text">g) 生产环境配置文件总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-React-事件处理"><span class="toc-number">6.</span> <span class="toc-text">6. React 事件处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-事件绑定"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 事件绑定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-修改事件的this并传递参数"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 修改事件的this并传递参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-绑定文本框与state中的值"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 绑定文本框与state中的值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-表单受控组件"><span class="toc-number">6.3.1.</span> <span class="toc-text">6.3.1 表单受控组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-表单非受控组件"><span class="toc-number">6.3.2.</span> <span class="toc-text">6.3.2 表单非受控组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-3-受控组件和非受控组件"><span class="toc-number">6.3.3.</span> <span class="toc-text">6.3.3 受控组件和非受控组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-React-createRef"><span class="toc-number">6.4.</span> <span class="toc-text">6.4 React.createRef</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-1-为dom元素添加ref"><span class="toc-number">6.4.1.</span> <span class="toc-text">6.4.1 为dom元素添加ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-2-为class组件添加ref"><span class="toc-number">6.4.2.</span> <span class="toc-text">6.4.2 为class组件添加ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-3-函数组件与ref"><span class="toc-number">6.4.3.</span> <span class="toc-text">6.4.3 函数组件与ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-4-ref转发"><span class="toc-number">6.4.4.</span> <span class="toc-text">6.4.4 ref转发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-ref回调"><span class="toc-number">6.5.</span> <span class="toc-text">6.5 ref回调</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-1-基本使用"><span class="toc-number">6.5.1.</span> <span class="toc-text">6.5.1 基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-2-父子之间传递回调ref"><span class="toc-number">6.5.2.</span> <span class="toc-text">6.5.2 父子之间传递回调ref</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-6-过时-API：String-类型的-Refs"><span class="toc-number">6.6.</span> <span class="toc-text">6.6 过时 API：String 类型的 Refs</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-React组件的通信"><span class="toc-number">7.</span> <span class="toc-text">7 React组件的通信</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-父子组件的通信"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 父子组件的通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-父组件传递给子组件"><span class="toc-number">7.1.1.</span> <span class="toc-text">a) 父组件传递给子组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-子组件传递给父组件"><span class="toc-number">7.1.2.</span> <span class="toc-text">b) 子组件传递给父组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-评论列表发表评论"><span class="toc-number">7.1.3.</span> <span class="toc-text">c) 评论列表发表评论</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-使用Context实现跨组件通信"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 使用Context实现跨组件通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-父子组件传递数据的方式"><span class="toc-number">7.2.1.</span> <span class="toc-text">a) 父子组件传递数据的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-使用Context跨级传递数据"><span class="toc-number">7.2.2.</span> <span class="toc-text">b) 使用Context跨级传递数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-使用自定义事件实现组件通讯"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 使用自定义事件实现组件通讯</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-React组件的生命周期"><span class="toc-number">8.</span> <span class="toc-text">8. React组件的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-生命周期钩子函数介绍"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 生命周期钩子函数介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-defaultProps及类型校验"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 defaultProps及类型校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-prop-types"><span class="toc-number">8.2.1.</span> <span class="toc-text">8.2.1 prop-types</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-defaultProps"><span class="toc-number">8.2.2.</span> <span class="toc-text">8.2.2 defaultProps</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-生命周期函数详解"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 生命周期函数详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-组件的重新渲染和优化"><span class="toc-number">8.4.</span> <span class="toc-text">8.4 组件的重新渲染和优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-1-shouldComponentUpdate优化"><span class="toc-number">8.4.1.</span> <span class="toc-text">8.4.1 shouldComponentUpdate优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-2-PureComponent优化"><span class="toc-number">8.4.2.</span> <span class="toc-text">8.4.2 PureComponent优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-getDerivedStateFromProps存在的问题"><span class="toc-number">8.5.</span> <span class="toc-text">8.5 getDerivedStateFromProps存在的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-6-React老版本生命周期"><span class="toc-number">8.6.</span> <span class="toc-text">8.6 React老版本生命周期</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-React-router"><span class="toc-number">9.</span> <span class="toc-text">9. React-router</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-前端路由的两种实现方案"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 前端路由的两种实现方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-Reac中的路由"><span class="toc-number">9.2.</span> <span class="toc-text">9.2 Reac中的路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-HashRouter的基本使用"><span class="toc-number">9.3.</span> <span class="toc-text">9.3 HashRouter的基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-匹配规则"><span class="toc-number">9.4.</span> <span class="toc-text">9.4 匹配规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-Switch和Redirect"><span class="toc-number">9.5.</span> <span class="toc-text">9.5 Switch和Redirect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-React中的编程式导航和路由传参"><span class="toc-number">9.6.</span> <span class="toc-text">9.6 React中的编程式导航和路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-1-withRouter的使用"><span class="toc-number">9.6.1.</span> <span class="toc-text">9.6.1 withRouter的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-2-使用withRouter跳转页面"><span class="toc-number">9.6.2.</span> <span class="toc-text">9.6.2 使用withRouter跳转页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-3-路由传参"><span class="toc-number">9.6.3.</span> <span class="toc-text">9.6.3 路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-params方式传参"><span class="toc-number">9.6.3.1.</span> <span class="toc-text">a) params方式传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-query方式传参"><span class="toc-number">9.6.3.2.</span> <span class="toc-text">b) query方式传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-state方式传参"><span class="toc-number">9.6.3.3.</span> <span class="toc-text">c) state方式传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-search方式传参"><span class="toc-number">9.6.3.4.</span> <span class="toc-text">d) search方式传参</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-7-组件懒加载"><span class="toc-number">9.7.</span> <span class="toc-text">9.7 组件懒加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-8-基于路由的代码分割"><span class="toc-number">9.8.</span> <span class="toc-text">9.8 基于路由的代码分割</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-ReactTransitionGroup动画"><span class="toc-number">10.</span> <span class="toc-text">10.ReactTransitionGroup动画</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-Transition"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 Transition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-CSSTransition"><span class="toc-number">10.2.</span> <span class="toc-text">10.2 CSSTransition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-SwitchTransition"><span class="toc-number">10.3.</span> <span class="toc-text">10.3 SwitchTransition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4-TransitionGroup"><span class="toc-number">10.4.</span> <span class="toc-text">10.4 TransitionGroup</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-高阶组件"><span class="toc-number">11.</span> <span class="toc-text">11.高阶组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-高阶函数"><span class="toc-number">11.1.</span> <span class="toc-text">11.1 高阶函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-高阶组件"><span class="toc-number">11.2.</span> <span class="toc-text">11.2 高阶组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-1-高阶组件的实现方式-属性代理"><span class="toc-number">11.2.1.</span> <span class="toc-text">11.2.1 高阶组件的实现方式-属性代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-属性代理-更改props"><span class="toc-number">11.2.1.1.</span> <span class="toc-text">a) 属性代理-更改props</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-属性代理-通过refs获取组件实例"><span class="toc-number">11.2.1.2.</span> <span class="toc-text">b) 属性代理-通过refs获取组件实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-属性代理-抽取state"><span class="toc-number">11.2.1.3.</span> <span class="toc-text">c) 属性代理-抽取state</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-属性代理-用其他元素包装组件"><span class="toc-number">11.2.1.4.</span> <span class="toc-text">d) 属性代理-用其他元素包装组件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-2-高阶组件的实现方式-反向继承"><span class="toc-number">11.2.2.</span> <span class="toc-text">11.2.2 高阶组件的实现方式-反向继承</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-反向继承-渲染劫持"><span class="toc-number">11.2.2.1.</span> <span class="toc-text">a) 反向继承-渲染劫持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-反向继承-修改state"><span class="toc-number">11.2.2.2.</span> <span class="toc-text">b) 反向继承-修改state</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-相关文章"><span class="toc-number">12.</span> <span class="toc-text">12. 相关文章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-React-Developer-Tools-调试工具"><span class="toc-number">12.1.</span> <span class="toc-text">安装 React Developer Tools 调试工具</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2035944494,3453366933&amp;fm=26&amp;gp=0.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">小逸的博客</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 列表</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">React</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2019-09-27 00:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-09-27</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-28 10:47:35"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-28</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="1-React简介"><a href="#1-React简介" class="headerlink" title="1. React简介"></a>1. React简介</h1><h2 id="1-1-React介绍"><a href="#1-1-React介绍" class="headerlink" title="1.1 React介绍"></a>1.1 React介绍</h2><ul>
<li><p>React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。</p>
</li>
<li><p>React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东西很好用，<strong>就在2013年5月开源了</strong>。</p>
</li>
<li><p>React 拥有较高的性能，代码逻辑非常简单，越来越多的人已开始关注和使用它。由于 React 的<strong>设计思想极其独特</strong>，属于革命性创新，性能出众，代码逻辑却非常简单。所以，越来越多的人开始关注和使用，认为它可能是将来 Web 开发的主流工具。</p>
</li>
<li><p>清楚两个概念：</p>
<ul>
<li><p>library（库）：小而巧的库，只提供了特定的API；优点就是 船小好掉头，可以很方便的从一个库切换到另外的库；但是代码几乎不会改变；比如从jQuery切换到</p>
</li>
<li><p>Framework（框架）：大而全的是框架；框架提供了一整套的解决方案；所以如果在项目中间，想切换到另外的框架，是比较困难的；</p>
</li>
</ul>
</li>
</ul>
<h2 id="1-2-前端三大主流框架"><a href="#1-2-前端三大主流框架" class="headerlink" title="1.2 前端三大主流框架"></a>1.2 前端三大主流框架</h2><ul>
<li>Angular.js：出来<strong>较早</strong>的前端框架，学习曲线比较陡，NG1学起来比较麻烦，NG2 ~ NG5开始，进行了一系列的改革，也提供了组件化开发的概念；从NG2开始，也支持使用TS（TypeScript）进行编程；</li>
</ul>
<ul>
<li><p>Vue.js：<strong>最火</strong>（关注的人比较多）的一门前端框架，它是中国人开发的，对我们来说，文档要友好一些；</p>
</li>
<li><p>React.js：<strong>最流行</strong>（用的人比较多）的一门框架，因为它的设计很优秀；</p>
</li>
</ul>
<h2 id="1-3-React与Vue的对比"><a href="#1-3-React与Vue的对比" class="headerlink" title="1.3 React与Vue的对比"></a>1.3 React与Vue的对比</h2><p><strong>1、监听数据变化的实现原理不同</strong></p>
<ul>
<li>Vue 通过 getter/setter 以及一些函数的劫持，能精确知道数据变化，不需要特别的优化就能达到很好的性能</li>
<li>React 默认是通过比较引用地址的方式进行的，如果不优化（PureComponent/shouldComponentUpdate）可能导致大量不必要的VDOM的重新渲染</li>
</ul>
<p><strong>2、数据流的不同</strong></p>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1574133046838.png"  alt="img"></p>
<p>大家都知道Vue中默认是支持双向绑定的。在Vue1.0中我们可以实现两种双向绑定：</p>
<ol>
<li>父子组件之间，props 可以双向绑定</li>
<li>组件与DOM之间可以通过 v-model 双向绑定</li>
</ol>
<p>在 Vue2.x 中去掉了第一种，也就是父子组件之间不能双向绑定了（但是提供了一个语法糖自动帮你通过事件的方式修改），并且 Vue2.x 已经不鼓励组件对自己的 props 进行任何修改了。所以现在我们只有 组件 &lt;––&gt; DOM 之间的双向绑定这一种。</p>
<p>然而 React 从诞生之初就不支持双向绑定，React一直提倡的是单向数据流，他称之为 onChange/setState()模式。</p>
<p>不过由于我们一般都会用 Vuex 以及 Redux 等单向数据流的状态管理框架，因此很多时候我们感受不到这一点的区别了。</p>
<p><strong>3、模板渲染方式的不同</strong></p>
<p>在表层上， 模板的语法不同</p>
<ul>
<li>React 是通过JSX渲染模板</li>
<li>而Vue是通过一种拓展的HTML语法进行渲染</li>
</ul>
<p>但其实这只是表面现象，毕竟React并不必须依赖JSX。在深层上，模板的原理不同，这才是他们的本质区别：</p>
<ul>
<li>React是在组件JS代码中，通过原生JS实现模板中的常见语法，比如插值，条件，循环等，都是通过JS语法实现的</li>
<li>Vue是在和组件JS代码分离的单独的模板中，通过指令来实现的，比如条件语句就需要 v-if 来实现</li>
</ul>
<p><strong>4、Vuex 和 Redux 的区别</strong></p>
<p>从表面上来说，store 注入和使用方式有一些区别。</p>
<p>在 Vuex 中，$store 被直接注入到了组件实例中，因此可以比较灵活的使用：</p>
<ul>
<li>使用 dispatch 和 commit 提交更新</li>
<li>通过 mapState 或者直接通过 this.$store 来读取数据</li>
</ul>
<p>在 Redux 中，我们每一个组件都需要显示的用 connect 把需要的 props 和 dispatch 连接起来。</p>
<p>另外 Vuex 更加灵活一些，组件中既可以 dispatch action 也可以 commit reducer，而 Redux 中只能进行 dispatch，并不能直接调用 reducer 进行修改。</p>
<p>从实现原理上来说，最大的区别是两点：</p>
<ul>
<li>Redux 使用的是不可变数据，而Vuex的数据是可变的。Redux每次都是用新的state替换旧的state，而Vuex是直接修改</li>
<li>Redux 在检测数据变化的时候，是比较对象的引用地址；而Vuex其实和Vue的原理一样，是通过 getter/setter来比较的（如果看Vuex源码会知道，其实他内部直接创建一个Vue实例用来跟踪数据变化）</li>
</ul>
<p><strong>5、总结</strong></p>
<p>React更偏向于构建稳定大型的应用，非常的科班化。相比之下，Vue更偏向于简单迅速的解决问题，更灵活，不那么严格遵循条条框框。因此也会给人一种大型项目用React，小型项目用 Vue 的感觉。</p>
<h2 id="1-4-React中几个核心的概念"><a href="#1-4-React中几个核心的概念" class="headerlink" title="1.4 React中几个核心的概念"></a>1.4 React中几个核心的概念</h2><h3 id="1-4-1-虚拟DOM（Virtual-Document-Object-Model）"><a href="#1-4-1-虚拟DOM（Virtual-Document-Object-Model）" class="headerlink" title="1.4.1 虚拟DOM（Virtual Document Object Model）"></a>1.4.1 虚拟DOM（Virtual Document Object Model）</h3><ul>
<li><strong>DOM的本质是什么</strong>：浏览器中的概念，用JS对象来表示页面上的元素，并提供了操作 DOM 对象的API；</li>
<li><strong>什么是React中的虚拟DOM</strong>：是框架中的概念，是程序员用JS对象来模拟页面上的 DOM 和 DOM嵌套；</li>
<li><strong>为什么要实现虚拟DOM（虚拟DOM的目的）：</strong>为了实现页面中DOM 元素的高效更新</li>
<li><strong>DOM和虚拟DOM的区别</strong>：</li>
</ul>
<p><img src="/" class="lazyload" data-src="images/%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E6%A6%82%E5%BF%B5.png"  alt></p>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1552877849641.png"  alt="1552877849641"></p>
<h3 id="1-4-2-react的Diff算法"><a href="#1-4-2-react的Diff算法" class="headerlink" title="1.4.2 react的Diff算法"></a>1.4.2 react的Diff算法</h3><p><img src="/" class="lazyload" data-src="/2019/09/27/React/Diff.png"  alt="Diff算法图"></p>
<p>其实传统diff算法就是对每个节点一一对比，循环遍历所有的子节点，然后判断子节点的更新状态。通过循环递归对节点进行依次对比，算法时间复杂度达到 O(n^3) ，n是树的节点数，这个有多可怕呢？——如果要展示1000个节点，得执行上亿次比较。即便是CPU快能执行30亿条命令，也<strong>很难在一秒内</strong>计算出差异。</p>
<p>React 通过制定大胆的策略，将 O(n^3) 复杂度的问题转换成 O(n) 复杂度的问题。react根据自己的特点，实现了部分代码的简化。</p>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1552878167661.png"  alt="1552878167661"></p>
<h4 id="a-tree-diff"><a href="#a-tree-diff" class="headerlink" title="a) tree diff"></a>a) tree diff</h4><blockquote>
<p>（1）React通过updateDepth对Virtual DOM树进行层级控制。<br>（2）对树分层比较，两棵树只对同一层次节点进行比较。如果该节点不存在时，则该节点及其子节点会被完全删除，不会再进一步比较。<br>（3）只需遍历一次就能完成整棵DOM树的比较。</p>
</blockquote>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1562723697592.png"  alt="1562723697592"></p>
<blockquote>
<p>那么问题来了，如果DOM节点出现了跨层级操作,diff会咋办呢？<br>答：diff只简单考虑同层级的节点位置变换，如果是跨层级的话，只有创建节点和删除节点的操作。</p>
</blockquote>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1562723819718.png"  alt="1562723819718"></p>
<blockquote>
<p>如上图所示，以A为根节点的整棵树会被<strong>重新创建，而不是移动</strong>，因此 <strong>官方建议不要进行DOM节点跨层级操作，可以通过CSS隐藏、显示节点，而不是真正地移除、添加DOM节点</strong>。</p>
</blockquote>
<h4 id="b-component-diff"><a href="#b-component-diff" class="headerlink" title="b) component diff"></a>b) component diff</h4><p>React应用是基于组件构建的，对于组件的比较优化侧重于以下几点：</p>
<blockquote>
<ol>
<li>同一类型组件遵从tree diff比较v-dom树</li>
<li>不同类型组件，先将该组件归类为dirty component，替换下整个组件下的所有子节点</li>
<li>同一类型组件Virtual Dom没有变化，React允许开发者使用shouldComponentUpdate()来判断该组件是否进行diff，运用得当可以节省diff计算时间，提升性能</li>
</ol>
</blockquote>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1562723945651.png"  alt="1562723945651"></p>
<p>如上图，当组件D → 组件G时，diff判断为不同类型的组件，虽然它们的结构相似甚至一样，diff仍然不会比较二者结构，会直接销毁D及其子节点，然后新建一个G相关的子tree，这显然会影响性能，官方虽然认定这种情况极少出现，但是开发中的这种现象造成的影响是非常大的。</p>
<h4 id="c-element-diff"><a href="#c-element-diff" class="headerlink" title="c) element diff"></a>c) element diff</h4><p>对于同一层级的element节点，diff提供了以下3种节点操作：</p>
<blockquote>
<ol>
<li>INSERT_MARKUP 插入节点</li>
<li>MOVE_EXISING 移动节点</li>
<li>REMOVE_NODE 移除节点</li>
</ol>
</blockquote>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1562724094202.png"  alt="1562724094202"></p>
<p>一般diff在比较集合[A,B,C,D]和[B，A，D，C]的时候会进行全部对比，即按对应位置逐个比较，发现每个位置对应的元素都有所更新，则把旧集合全部移除，替换成新的集合，如上图，但是这样的操作在React中显然是复杂、低效、影响性能的操作，因为新集合中所有的元素都可以进行复用，无需删除重新创建，耗费性能和内存，只需要移动元素位置即可。</p>
<p>React对这一现象做出了一个高效的策略：允许开发者对同一层级的同组子节点添加唯一key值进行区分。意义就是代码上的一小步，性能上的一大步，甚至是翻天覆地的变化！</p>
<h1 id="2-React入门案例"><a href="#2-React入门案例" class="headerlink" title="2. React入门案例"></a>2. React入门案例</h1><h2 id="2-1-创建webpack应用"><a href="#2-1-创建webpack应用" class="headerlink" title="2.1 创建webpack应用"></a>2.1 创建webpack应用</h2><ol>
<li><p>运行<code>npm init -y</code> 快速初始化项目</p>
</li>
<li><p>在项目根目录创建<code>src</code>源代码目录和<code>dist</code>产品目录</p>
</li>
<li><p>在 src 目录下创建 <code>index.html和main.js</code></p>
</li>
<li><p>安装webpack和webpack-cli</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack@<span class="number">4.27</span><span class="number">.1</span> -d</span><br><span class="line">npm install webpack-cli -d       提供一些基本命令(比如webpack命令)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建webpack.config.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>)</span><br><span class="line"><span class="comment">//webpack基于node构建的，所有用的是CommonJS模块化规范</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode:<span class="string">"development"</span>,</span><br><span class="line">    entry: path.join(__dirname, <span class="string">'./src/main.js'</span>),</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>index.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    &lt;script src="../</span>dist/bundle.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用webpack命令打包项目，运行index.html查看结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置webpack-dev-server</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#1.安装webpack-dev-serve</span><br><span class="line">npm install  webpack-dev-server -d</span><br><span class="line"></span><br><span class="line">#2.package.json的scripts添加dev</span><br><span class="line"> <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --open --port 3000 --hot --host 127.0.0.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"> #3.npm run dev     webpack-dev-server将打包后的bundle.js托管到项目根路径下(内存中)，所以可以通过下面路径访问</span><br><span class="line">  http:<span class="comment">//localhost:8080/bundle.js    </span></span><br><span class="line"></span><br><span class="line">#4.修改index.html中引入bundle.js的路径</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">	&lt;!--使用webpack-dev-server打包后内存中的bundle.js--&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script src="../</span>bundle.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用html-webpack-plugin将index.html配置到内存</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#1.安装html-webpack-plugin</span><br><span class="line">npm i html-webpack-plugin@<span class="number">3.2</span><span class="number">.0</span> --save-dev</span><br><span class="line"></span><br><span class="line">#2.修改webpack.config.js配置</span><br><span class="line"><span class="comment">// 导入自动生成HTMl文件的插件</span></span><br><span class="line"><span class="keyword">var</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: path.join(__dirname, <span class="string">'./src/main.js'</span>),</span><br><span class="line">    output: &#123; </span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>), </span><br><span class="line">        filename: <span class="string">'bundle.js'</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [ </span><br><span class="line">        <span class="comment">// 添加plugins节点配置插件</span></span><br><span class="line">        <span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">            template:path.resolve(__dirname, <span class="string">'src/index.html'</span>),<span class="comment">//模板路径</span></span><br><span class="line">            filename:<span class="string">'index.html'</span><span class="comment">//自动生成的HTML文件的名称</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="2-2-在webpack中使用-react"><a href="#2-2-在webpack中使用-react" class="headerlink" title="2.2 在webpack中使用 react"></a>2.2 在webpack中使用 react</h2><ol>
<li><p>运行 <code>npm install react react-dom -S</code> 安装包</p>
<ul>
<li>react： 专门用于创建组件和虚拟DOM的，同时组件的生命周期都在这个包中</li>
<li>react-dom： 专门进行DOM操作的，最主要的应用场景，就是<code>ReactDOM.render()</code></li>
</ul>
</li>
<li><p>在<code>index.html</code>页面中，创建容器：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 容器，将来，使用 React 创建的虚拟DOM元素，都会被渲染到这个指定的容器中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>main.js导入包：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>                        <span class="comment">// 创建组件、虚拟DOM元素，生命周期</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>      <span class="comment">// 把创建好的 组件 和 虚拟DOM 放到页面上展示的</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建虚拟DOM元素：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是 创建虚拟DOM元素的 API    &lt;h1 title="啊，五环" id="myh1"&gt;你比四环多一环&lt;/h1&gt;</span></span><br><span class="line"><span class="comment">//  第一个参数： 字符串类型的参数，表示要创建的标签的名称</span></span><br><span class="line"><span class="comment">//  第二个参数：对象类型的参数， 表示 创建的元素的属性节点</span></span><br><span class="line"><span class="comment">//  第三个参数： 子节点（包括 其它 虚拟DOM 获取 文本子节点）</span></span><br><span class="line"><span class="comment">//  参数n :  其它子节点</span></span><br><span class="line"><span class="keyword">const</span> myh1 = React.createElement(<span class="string">'h1'</span>, &#123; <span class="attr">title</span>: <span class="string">'啊，五环'</span>, <span class="attr">id</span>: <span class="string">'myh1'</span> &#125;, <span class="string">'你比四环多一环'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mydiv = React.createElement(<span class="string">'div'</span>, <span class="literal">null</span>, <span class="string">'这是一个div元素'</span>, myh1)</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="5">
<li><p>渲染：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. 渲染虚拟DOM元素</span></span><br><span class="line"><span class="comment">// 参数1： 表示要渲染的虚拟DOM对象</span></span><br><span class="line"><span class="comment">// 参数2： 指定容器,注意：这里不能直接放 容器元素的Id字符串，需要放一个容器的DOM对象</span></span><br><span class="line">ReactDOM.render(myh1, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h2 id="2-3-JSX语法"><a href="#2-3-JSX语法" class="headerlink" title="2.3 JSX语法"></a>2.3 JSX语法</h2><blockquote>
<p>什么是JSX语法：就是符合 xml 规范的 JS 语法；（语法格式相对来说，要比HTML严谨很多）</p>
</blockquote>
<h3 id="2-3-1-启用-JSX-语法"><a href="#2-3-1-启用-JSX-语法" class="headerlink" title="2.3.1 启用 JSX 语法"></a>2.3.1 启用 JSX 语法</h3><p>浏览器目前还不支持 ES6 模块，比如这种ES6语法在浏览器和node中都不被支持    <code>import fs from &#39;fs&#39;</code>，为了现在就能使用，我们可以使用转码器(ES6–&gt;ES5)，也可以使用Browserify。</p>
<p>知名度比较大的转码器有Traceur和babel，babel将ES6代码编译为大多数浏览器（包括IE9）支持的ES5代码。</p>
<ul>
<li><p>安装 <code>babel</code> 插件</p>
<ul>
<li>运行<code>npm i babel-core@6.26.3 babel-loader@7.1.5 babel-plugin-transform-runtime --save-dev</code></li>
<li>运行<code>npm i babel-preset-env babel-preset-stage-0 --save-dev</code></li>
</ul>
</li>
<li><p>安装能够识别转换jsx语法的包 <code>babel-preset-react</code> </p>
<ul>
<li>运行<code>npm i babel-preset-react -D</code></li>
</ul>
</li>
<li><p>添加 <code>.babelrc</code> 配置文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [<span class="string">"env"</span>, <span class="string">"stage-0"</span>, <span class="string">"react"</span>],</span><br><span class="line">  <span class="attr">"plugins"</span>: [<span class="string">"transform-runtime"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加babel-loader配置项：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123; <span class="comment">//要打包的第三方模块</span></span><br><span class="line">    rules: [</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.js|jsx$/</span>, <span class="attr">use</span>: <span class="string">'babel-loader'</span>, <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 在main.js中使用JSX语法 </span><br><span class="line"><span class="keyword">const</span> mydiv2 = <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>哈哈<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">ReactDOM.render(mydiv2, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-JSX-语法"><a href="#2-3-2-JSX-语法" class="headerlink" title="2.3.2 JSX 语法"></a>2.3.2 JSX 语法</h3><p>JSX语法的本质：并不是直接把 jsx 渲染到页面上，而是内部通过 createElement 再渲染到页面；</p>
<p>在 jsx 中混合写入 js 表达式：在 jsx 语法中，要把 JS代码写到    <code>{ }</code> 中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2. JSX中使用数值、字符串、bool、数组等信息</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">'你好，中国'</span></span><br><span class="line"><span class="keyword">let</span> boo = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> title = <span class="string">'999'</span></span><br><span class="line"><span class="keyword">const</span> h1 = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>红火火恍恍惚惚<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> arr = [</span><br><span class="line">  &lt;h2&gt;这是h2&lt;<span class="regexp">/h2&gt;,</span></span><br><span class="line"><span class="regexp">  &lt;h3&gt;这是h3&lt;/</span>h3&gt;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> arrStr = [<span class="string">'毛利兰'</span>, <span class="string">'柯南'</span>, <span class="string">'小五郎'</span>, <span class="string">'灰原哀'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个空数组，将来用来存放 名称 标签【方案1】</span></span><br><span class="line"><span class="keyword">const</span> nameArr = []</span><br><span class="line"><span class="comment">// 注意： React 中，需要把 key 添加给 被 forEach 或 map 或 for 循环直接控制的元素</span></span><br><span class="line">arrStr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> temp = <span class="xml"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">key</span>=<span class="string">&#123;item&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line">  nameArr.push(temp)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组的 map 方法, map 中必须写 return</span></span><br><span class="line"><span class="comment">/* const result = arrStr.map(item =&gt; &#123;</span></span><br><span class="line"><span class="comment">  return item + '~~'</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">console.log(result) */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 调用 render 函数渲染   JSX  XML 比 HTML 严格多了</span></span><br><span class="line"><span class="comment">// 在JSX要使用JS，则需要把 JS 代码写到 &#123;&#125; 中</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;a + 2&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;str&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;boo ? '条件为真' : '条件为假'&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span>&gt;</span>这是p标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;h1&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;/* &#123;arr&#125; */&#125;</span></span><br><span class="line"><span class="xml">  &#123;</span></span><br><span class="line"><span class="xml">    // 这是注释，你看不见我</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;nameArr&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line">  &#123;arrStr.map(item =&gt; &lt;div key=&#123;item&#125;&gt;&lt;h3&gt;&#123;item&#125;&lt;/h3&gt;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"ooo"</span>&gt;</span>11111<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br><span class="line">        </span><br><span class="line">                </span><br><span class="line"> #注意点：</span><br><span class="line"><span class="number">1.</span> 在 JSX 中 写注释：推荐使用&#123; <span class="comment">/* 这是注释 */</span> &#125;</span><br><span class="line"><span class="number">2.</span> 为 JSX 中的htmlFor替换label的<span class="keyword">for</span>属性</span><br><span class="line"><span class="number">3.</span> 在 JSX 创建DOM的时候，所有的节点，必须有唯一的根元素进行包裹；</span><br><span class="line"><span class="number">4.</span> 在 JSX 语法中，标签必须成对出现，如果是单标签，则必须自闭和！</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当 编译引擎，在编译JSX代码的时候，如果遇到了<code>&lt;</code>那么就把它当作 HTML代码去编译，如果遇到了 <code>{}</code> 就把 花括号内部的代码当作普通JS代码去编译；</p>
</blockquote>
<h1 id="3-React中创建组件"><a href="#3-React中创建组件" class="headerlink" title="3. React中创建组件"></a>3. React中创建组件</h1><h2 id="3-1-使用构造函数来创建组件"><a href="#3-1-使用构造函数来创建组件" class="headerlink" title="3.1 使用构造函数来创建组件"></a>3.1 使用构造函数来创建组件</h2><blockquote>
<p>如果要接收外界传递的数据，需要在构造函数的参数列表中使用<code>props</code>来接收；</p>
<p>必须要向外return一个合法的JSX创建的虚拟DOM；</p>
</blockquote>
<h3 id="3-1-1-创建组件"><a href="#3-1-1-创建组件" class="headerlink" title="3.1.1 创建组件"></a>3.1.1 创建组件</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种创建组件的方式 ： 注意构造函数首字母必须大写</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span> (<span class="params">props</span>) </span>&#123; </span><br><span class="line">    <span class="comment">// 如果 在一个组件种 return 一个 null。则表示此组件是空的，什么都不会渲染</span></span><br><span class="line">	<span class="comment">// return null </span></span><br><span class="line">    <span class="comment">// 在组件中，必须 返回一个 合法的 JSX 虚拟DOM元素</span></span><br><span class="line">	<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello 组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-为组件传递数据"><a href="#3-1-2-为组件传递数据" class="headerlink" title="3.1.2 为组件传递数据"></a>3.1.2 为组件传递数据</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// props.name = 'zs'     不论是 Vue 还是 React，组件中的 props 永远都是只读的；不能被重新赋值;</span></span><br><span class="line">  <span class="built_in">console</span>.log(props)</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>这是 Hello 组件 --- &#123;props.name&#125; --- &#123;props.age&#125; --- &#123;props.gender&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = &#123;</span><br><span class="line">  name: <span class="string">'大黄'</span>,</span><br><span class="line">  age: <span class="number">3</span>,</span><br><span class="line">  gender: <span class="string">'雄'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  123</span></span><br><span class="line"><span class="xml">  &#123;/* 直接把 组件的名称，以标签形式，丢到页面上即可 */&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Hello</span> <span class="attr">name</span>=<span class="string">&#123;dog.name&#125;</span> <span class="attr">age</span>=<span class="string">&#123;dog.age&#125;</span> <span class="attr">gender</span>=<span class="string">&#123;dog.gender&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Hello</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;/* 使用&#123;...obj&#125;属性扩散传递数据 */&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Hello</span> &#123;<span class="attr">...dog</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">Hello</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 关于es6的展开运算符</span><br><span class="line"><span class="keyword">var</span> o2 = &#123;</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">  address: <span class="string">'中国北京'</span>,</span><br><span class="line">  phone: <span class="string">'139999'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o1 = &#123;</span><br><span class="line">  name: <span class="string">'zs'</span>,</span><br><span class="line">  ...o2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o1)</span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-封装组件到独立文件"><a href="#3-1-3-封装组件到独立文件" class="headerlink" title="3.1.3 封装组件到独立文件"></a>3.1.3 封装组件到独立文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#1. 新建Hello.jsx，并导出组件</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="comment">// 第一种创建组件的方式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 如果 在一个组件中 return 一个 null。则表示此组件是空的，什么都不会渲染</span></span><br><span class="line">  <span class="comment">// return null</span></span><br><span class="line">  <span class="comment">// 在组件中，必须 返回一个 合法的 JSX 虚拟DOM元素</span></span><br><span class="line">  <span class="comment">// props.name = 'zs'</span></span><br><span class="line">  <span class="built_in">console</span>.log(props)</span><br><span class="line">  <span class="comment">// 结论：不论是 Vue 还是 React，组件中的 props 永远都是只读的；不能被重新赋值；</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>这是 Hello 组件 --- &#123;props.name&#125; --- &#123;props.age&#125; --- &#123;props.gender&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把组件暴露出去</span></span><br><span class="line"><span class="comment">// export default Hello</span></span><br><span class="line"></span><br><span class="line">#2.导入Hello.jsx</span><br><span class="line">  <span class="comment">// 1. 导入包</span></span><br><span class="line">  <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line">  <span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line">  <span class="comment">// 注意： 这里的 @ 符号，表示 项目根目录中的 src 这一层目录</span></span><br><span class="line">  <span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">'@/components/Hello.jsx'</span></span><br><span class="line">  <span class="keyword">const</span> dog = &#123;</span><br><span class="line">    name: <span class="string">'大黄'</span>,</span><br><span class="line">    age: <span class="number">3</span>,</span><br><span class="line">    gender: <span class="string">'雄'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    123</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Hello</span> &#123;<span class="attr">...dog</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">Hello</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br><span class="line">                  </span><br><span class="line">                  </span><br><span class="line">#3.在导入组件的时候，如何省略组件的.jsx后缀名</span><br><span class="line"><span class="comment">// 打开 webpack.config.js ，并在导出的配置对象中，新增 如下节点：</span></span><br><span class="line">  resolve: &#123;</span><br><span class="line">      extensions: [<span class="string">'.js'</span>, <span class="string">'.jsx'</span>, <span class="string">'.json'</span>], <span class="comment">// 表示，这几个文件的后缀名，可以省略不写</span></span><br><span class="line">      alias: &#123;</span><br><span class="line">          <span class="string">'@'</span>: path.join(__dirname, <span class="string">'./src'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-使用-class-关键字来创建组件"><a href="#3-2-使用-class-关键字来创建组件" class="headerlink" title="3.2 使用 class 关键字来创建组件"></a>3.2 使用 class 关键字来创建组件</h2><h3 id="3-2-1-ES6的class关键字"><a href="#3-2-1-ES6的class关键字" class="headerlink" title="3.2.1 ES6的class关键字"></a>3.2.1 ES6的class关键字</h3>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建了一个动物类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 每一个类中都有一个构造器，如果我们程序员没有手动指定构造器，那么，可以认为类内部有个隐形的、看不见的 空构造器，类似于 constructor()&#123;&#125;</span></span><br><span class="line">  <span class="comment">// 构造器的作用是每当 new 这个类的时候，必然会优先执行构造器中的代码</span></span><br><span class="line">  <span class="keyword">constructor</span>(name, age) &#123;</span><br><span class="line">    <span class="comment">// 实例属性</span></span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在 class 内部，通过 static 修饰的属性，就是静态属性</span></span><br><span class="line">  <span class="keyword">static</span> info = <span class="string">"eee"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这是动物的实例方法(挂载到原型对象上的实例方法)</span></span><br><span class="line">  jiao() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'动物的实例方法'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这是 动物 类的静态方法（今后用的不多）</span></span><br><span class="line">  <span class="keyword">static</span> show() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'这是 Animal 的静态 show 方法'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a1 = <span class="keyword">new</span> Animal(<span class="string">'大黄'</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">console</span>.log(a1)</span><br><span class="line"><span class="comment">// console.log(a1.name)// 实例属性</span></span><br><span class="line"><span class="comment">// console.log(a1.age) // 实例属性</span></span><br><span class="line"><span class="built_in">console</span>.log(Animal.info) <span class="comment">// info 是 Animal 的静态属性</span></span><br><span class="line">a1.jiao() <span class="comment">// 这是实例方法</span></span><br><span class="line">Animal.show() <span class="comment">// 静态方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//其实静态属性和静态方法都挂载到了constructor上面，而构造器又指向了函数本身，所以可以直接通过函数名来调用静态属性和静态方法</span></span><br></pre></td></tr></table></figure>

<p>ES6的class只是一个语法糖，其本质仍然是通过之前的构造函数来创建对象，而对应的实例属性、实例方法、静态属性、静态方法实质都是向对应的原型和constructor中新增属性和方法，没有实质的变化。</p>
<h3 id="3-2-2-class继承"><a href="#3-2-2-class继承" class="headerlink" title="3.2.2 class继承"></a>3.2.2 class继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是父类 </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age)&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 打招呼 的 实例方法</span></span><br><span class="line">  sayHello()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'大家好'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">American</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age)&#123;</span><br><span class="line">    <span class="comment">// super 是一个函数，它是父类的构造器；子类中的 super其实就是父类constructor 构造器的一个引用；</span></span><br><span class="line">    <span class="keyword">super</span>(name, age)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a1 = <span class="keyword">new</span> American(<span class="string">'Jack'</span>, <span class="number">20</span>)</span><br><span class="line"><span class="built_in">console</span>.log(a1)</span><br><span class="line">a1.sayHello()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是子类 中国人</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chinese</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="comment">// IDNumber 身份证号 【中国人独有的】，既然是独有的，就不适合 挂载到 父类上；</span></span><br><span class="line">  <span class="keyword">constructor</span>(name, age, IDNumber)&#123;</span><br><span class="line">    <span class="keyword">super</span>(name, age)</span><br><span class="line">    <span class="comment">// 语法规范：在子类中， this 只能放到 super 之后使用</span></span><br><span class="line">    <span class="keyword">this</span>.IDNumber = IDNumber</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c1 = <span class="keyword">new</span> Chinese(<span class="string">'张三'</span>, <span class="number">22</span>, <span class="string">'130428******'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(c1)</span><br><span class="line">c1.sayHello()</span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-基于class关键字创建组件"><a href="#3-2-3-基于class关键字创建组件" class="headerlink" title="3.2.3 基于class关键字创建组件"></a>3.2.3 基于class关键字创建组件</h3><p>最基本的组件结构：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让自己的组件继承React.Compoent，重写render方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> 组件名称 <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>这是 class 创建的组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// class 关键字创建组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 构造器</span></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// 由于 Movie 组件，继承了 React.Component 这个父类，所以自定义的构造器中必须调用 super()</span></span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="comment">// 只有调用了 super() 以后，才能使用 this 关键字。这个 this.state = &#123;&#125; 就相当于 Vue 中的 data() &#123; return &#123; &#125; &#125;</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123; </span><br><span class="line">      msg: <span class="string">'大家好，我是 class 创建的 Movie组件'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render 函数的作用，是 渲染 当前组件所对应的 虚拟DOM元素</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/* 注意：在 class 组件内部，this 表示 当前组件的实例对象。props数据不可以修改，state数据可以修改 */&#125;</span></span><br><span class="line"><span class="xml">      这是 Movie 组件 -- &#123;this.props.name&#125; -- &#123;this.props.age&#125; -- &#123;this.props.gender&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;this.state.msg&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">'zs'</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">  gender: <span class="string">'男'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 调用 render 函数渲染</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  123</span></span><br><span class="line"><span class="xml">  &#123;/* 这里的 Movie 标签，其实，就是 Movie 类的一个实例对象 */&#125;</span></span><br><span class="line"><span class="xml">  &#123;/* <span class="tag">&lt;<span class="name">Movie</span> <span class="attr">name</span>=<span class="string">&#123;user.name&#125;</span> <span class="attr">age</span>=<span class="string">&#123;user.age&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Movie</span>&gt;</span> */&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Movie</span> &#123;<span class="attr">...user</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">Movie</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-2-4-state的修改"><a href="#3-2-4-state的修改" class="headerlink" title="3.2.4 state的修改"></a>3.2.4 state的修改</h3><h4 id="a-不能直接修改-State"><a href="#a-不能直接修改-State" class="headerlink" title="a) 不能直接修改 State"></a>a) 不能直接修改 State</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.state.comment = <span class="string">'Hello'</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//可以这样修改State</span></span><br><span class="line"><span class="keyword">this</span>.setState(&#123;<span class="attr">comment</span>: <span class="string">'Hello'</span>&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="b-State的更新可能是异步的"><a href="#b-State的更新可能是异步的" class="headerlink" title="b) State的更新可能是异步的"></a>b) State的更新可能是异步的</h4><p>因为 <code>this.props</code> 和 <code>this.state</code> 可能会异步更新，所以你不要依赖他们的值来更新下一个状态。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用setState，组件的state并不会立即改变，setState只是把要修改的状态放入一个队列中，React会优化真正的执行时机，并且React会出于性能原因，可能会将多次setState的状态修改合并成一次状态修改。所以不要依赖当前的State，计算下个State。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//Wrong</span></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;<span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;<span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;<span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="comment">//结果state的count为1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Correct</span></span><br><span class="line">add = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">        count: state.count + <span class="number">1</span></span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">        count: state.count + <span class="number">1</span></span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">        count: state.count + <span class="number">1</span></span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="comment">//结果state的count为3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Wrong   因为state和props的更新可能是异步的，所以并不能保证counter中所获取到的state和props是最新的</span></span><br><span class="line"><span class="keyword">this</span>.setState(&#123;</span><br><span class="line">  counter: <span class="keyword">this</span>.state.counter + <span class="keyword">this</span>.props.increment,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Correct    这边的state表示之前的state状态了</span></span><br><span class="line"><span class="keyword">this</span>.setState(<span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123;</span><br><span class="line">  counter: state.counter + props.increment</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>state的更新既可能是同步的，也可能是异步的。 准确地说，在React内部机制能检测到的地方, setState就是异步的；在React检测不到的地方，例如setInterval、setTimeout里，setState就是同步更新的。</p>
</blockquote>
<h4 id="c-获取更新之后的state数据"><a href="#c-获取更新之后的state数据" class="headerlink" title="c) 获取更新之后的state数据"></a>c) 获取更新之后的state数据</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(</span><br><span class="line">    &#123; <span class="attr">data</span>: newData &#125;,</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="comment">//这里打印的是最新的state值</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.data);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="d-setState的实现过程"><a href="#d-setState的实现过程" class="headerlink" title="d) setState的实现过程"></a>d) setState的实现过程</h4><p><img src="/" class="lazyload" data-src="/2019/09/27/React/3941614716-5b13d6d716035_articlex.png"  alt="3941614716-5b13d6d716035_articlex"></p>
<h2 id="3-3-两种创建组件方式的对比"><a href="#3-3-两种创建组件方式的对比" class="headerlink" title="3.3 两种创建组件方式的对比"></a>3.3 两种创建组件方式的对比</h2><ol>
<li>用<strong>构造函数</strong>创建出来的组件：叫做“无状态组件”，只有props，没有自己的私有数据和生命周期函数</li>
<li>用<strong>class关键字</strong>创建出来的组件：叫做“有状态组件”，有私有数据和生命周期函数</li>
</ol>
<blockquote>
<p>有状态组件和无状态组件之间的<strong>本质区别</strong>就是：有无state属性！无状态组件由于没有私有数据和生命周期函数，运行效率会比有状态组件高一些。</p>
</blockquote>
<h2 id="3-4-条件渲染"><a href="#3-4-条件渲染" class="headerlink" title="3.4 条件渲染"></a>3.4 条件渲染</h2><h3 id="3-4-1-通过if来进行条件渲染"><a href="#3-4-1-通过if来进行条件渲染" class="headerlink" title="3.4.1 通过if来进行条件渲染"></a>3.4.1 通过if来进行条件渲染</h3><p><a href="https://blog.csdn.net/crystalqy/article/details/79066347" target="_blank" rel="noopener">https://blog.csdn.net/crystalqy/article/details/79066347</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Greeting</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = props.isLoggedIn;</span><br><span class="line">  <span class="keyword">if</span> (isLoggedIn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">UserGreeting</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">GuestGreeting</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="comment">// Try changing to isLoggedIn=&#123;true&#125;:</span></span><br><span class="line">  &lt;Greeting isLoggedIn=&#123;<span class="literal">false</span>&#125; /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-通过-amp-amp-进行条件渲染"><a href="#3-4-2-通过-amp-amp-进行条件渲染" class="headerlink" title="3.4.2 通过&amp;&amp;进行条件渲染"></a>3.4.2 通过&amp;&amp;进行条件渲染</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Mailbox</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> unreadMessages = props.unreadMessages;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Hello!&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &#123;unreadMessages.length &gt; 0 &amp;&amp;</span></span><br><span class="line"><span class="regexp">        &lt;h2&gt;</span></span><br><span class="line"><span class="regexp">          You have &#123;unreadMessages.length&#125; unread messages.</span></span><br><span class="line"><span class="regexp">        &lt;/</span>h2&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const messages = ['React', 'Re: React', 'Re:Re: React'];</span></span><br><span class="line"><span class="regexp">ReactDOM.render(</span></span><br><span class="line"><span class="regexp">  &lt;Mailbox unreadMessages=&#123;messages&#125; /</span>&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-三元运算符条件渲染"><a href="#3-4-3-三元运算符条件渲染" class="headerlink" title="3.4.3 三元运算符条件渲染"></a>3.4.3 三元运算符条件渲染</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = <span class="keyword">this</span>.state.isLoggedIn;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;isLoggedIn ? (</span><br><span class="line">        &lt;LogoutButton onClick=&#123;<span class="keyword">this</span>.handleLogoutClick&#125; /&gt;</span><br><span class="line">      ) : (</span><br><span class="line">        &lt;LoginButton onClick=&#123;<span class="keyword">this</span>.handleLoginClick&#125; /&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-4-阻止组件渲染"><a href="#3-4-4-阻止组件渲染" class="headerlink" title="3.4.4 阻止组件渲染"></a>3.4.4 阻止组件渲染</h3><p>在极少数情况下，你可能希望能隐藏组件，即使它已经被其他组件渲染。若要完成此操作，你可以让 <code>render</code> 方法直接返回 <code>null</code>，而不进行任何渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = <span class="keyword">this</span>.state.isLoggedIn;</span><br><span class="line">  <span class="keyword">if</span> (!isLoggedIn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;LoginButton onClick=&#123;<span class="keyword">this</span>.handleLoginClick&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-5-列表渲染"><a href="#3-5-列表渲染" class="headerlink" title="3.5 列表渲染"></a>3.5 列表渲染</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NumberList</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> numbers = props.numbers;</span><br><span class="line">  <span class="keyword">const</span> listItems = numbers.map(<span class="function">(<span class="params">number</span>) =&gt;</span></span><br><span class="line">    &lt;li key=&#123;number.toString()&#125;&gt;</span><br><span class="line">      &#123;number&#125;</span><br><span class="line">    &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;&#123;listItems&#125;&lt;/u</span>l&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;NumberList numbers=&#123;numbers&#125; /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//key 帮助 React 识别哪些元素改变了，比如被添加或删除。因此你应当给数组中的每一个元素赋予一个确定的标识。</span></span><br><span class="line"><span class="comment">//一个元素的 key 最好是这个元素在列表中拥有的一个独一无二的字符串。通常，我们使用来自数据 id 来作为元素的 key。key在兄弟节点之间必须唯一</span></span><br><span class="line"><span class="comment">//当元素没有确定 id 的时候，万不得已你可以使用元素索引 index 作为 key：</span></span><br><span class="line"><span class="keyword">const</span> todoItems = todos.map(<span class="function">(<span class="params">todo, index</span>) =&gt;</span></span><br><span class="line">  <span class="comment">// Only do this if items have no stable IDs</span></span><br><span class="line">  &lt;li key=&#123;index&#125;&gt;</span><br><span class="line">    &#123;todo.text&#125;</span><br><span class="line">  &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>

<h2 id="3-6-Fragment的使用"><a href="#3-6-Fragment的使用" class="headerlink" title="3.6 Fragment的使用"></a>3.6 Fragment的使用</h2><p>有时，语义化的 HTML 会被破坏。比如当在 JSX 中使用 <code>&lt;div&gt;</code> 元素来实现 React 代码功能的时候，又或是在使用列表（<code>&lt;ol&gt;</code>， <code>&lt;ul&gt;</code> 和 <code>&lt;dl&gt;</code>）和 HTML <code>&lt;table&gt;</code> 时。 在这种情况下，我们应该使用 <a href="https://react.docschina.org/docs/fragments.html" target="_blank" rel="noopener">React Fragments</a> 来组合各个组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Fragment &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ListItem</span>(<span class="params">&#123; item &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Fragment&gt;</span><br><span class="line">      &lt;dt&gt;&#123;item.term&#125;&lt;<span class="regexp">/dt&gt;</span></span><br><span class="line"><span class="regexp">      &lt;dd&gt;&#123;item.description&#125;&lt;/</span>dd&gt;</span><br><span class="line">    &lt;<span class="regexp">/Fragment&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Glossary(props) &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;dl&gt;</span></span><br><span class="line"><span class="regexp">      &#123;props.items.map(item =&gt; (</span></span><br><span class="line"><span class="regexp">        &lt;ListItem item=&#123;item&#125; key=&#123;item.id&#125; /</span>&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;<span class="regexp">/dl&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-7-React组合"><a href="#3-7-React组合" class="headerlink" title="3.7 React组合"></a>3.7 React组合</h2><p>react组合类似于Vue中的slot(插槽)，子组件的内容由父组件来指定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBorder</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;<span class="string">'FancyBorder FancyBorder-'</span> + props.color&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/*子组件：占坑*/</span>&#125;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function WelcomeDialog() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;FancyBorder color="blue"&gt;</span></span><br><span class="line"><span class="regexp">      &#123;/</span>*父组件中填坑*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">      &lt;h1 className="Dialog-title"&gt;</span></span><br><span class="line"><span class="regexp">        Welcome</span></span><br><span class="line"><span class="regexp">      &lt;/</span>h1&gt;</span><br><span class="line">      &lt;p className=<span class="string">"Dialog-message"</span>&gt;</span><br><span class="line">        Thank you <span class="keyword">for</span> visiting our spacecraft!</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>FancyBorder&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>少数情况下，你可能需要在一个组件中预留出几个“洞”。这种情况下，我们可以不使用 children，而是自行约定：将所需内容传入 props，并使用相应的 prop。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SplitPane</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"SplitPane"</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">"SplitPane-left"</span>&gt;</span><br><span class="line">        &#123;props.left&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div className="SplitPane-right"&gt;</span></span><br><span class="line"><span class="regexp">        &#123;props.right&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;SplitPane</span></span><br><span class="line"><span class="regexp">      left=&#123;</span></span><br><span class="line"><span class="regexp">        &lt;Contacts /</span>&gt;</span><br><span class="line">      &#125;</span><br><span class="line">      right=&#123;</span><br><span class="line">        &lt;Chat /&gt;</span><br><span class="line">      &#125; /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-评论列表案例"><a href="#4-评论列表案例" class="headerlink" title="4. 评论列表案例"></a>4. 评论列表案例</h1><p>思路：父组件中套了若干个评论Item子组件，所以需要创建两个组件，分别是：CmtList和CmtItem</p>
<h2 id="4-1-案例完成"><a href="#4-1-案例完成" class="headerlink" title="4.1 案例完成"></a>4.1 案例完成</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#1. CmtList组件</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 评论项 组件</span></span><br><span class="line"><span class="keyword">import</span> CmtItem <span class="keyword">from</span> <span class="string">'@/components/CmtItem'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">CmtList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      CommentList: [ <span class="comment">// 评论列表数据</span></span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">user</span>: <span class="string">'张三'</span>, <span class="attr">content</span>: <span class="string">'哈哈，沙发'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">user</span>: <span class="string">'李四'</span>, <span class="attr">content</span>: <span class="string">'哈哈，板凳'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">user</span>: <span class="string">'王五'</span>, <span class="attr">content</span>: <span class="string">'哈哈，凉席'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">user</span>: <span class="string">'赵六'</span>, <span class="attr">content</span>: <span class="string">'哈哈，砖头'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">user</span>: <span class="string">'田七'</span>, <span class="attr">content</span>: <span class="string">'哈哈，楼下山炮'</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/* 注意：在 JSX 中如果想写行内样式了，不能为 style 设置字符串的值 */&#125;</span></span><br><span class="line"><span class="xml">      &#123;/* 而是应该 这么写：    style=&#123; &#123; color: 'red' &#125; &#125; */&#125;</span></span><br><span class="line"><span class="xml">      &#123;/* 在 行内样式中，如果 是 数值类型的样式，则可以不用引号包裹，如果是 字符串类型的 样式值，必须使用 引号包裹 */&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> '<span class="attr">red</span>', <span class="attr">fontSize:</span> '<span class="attr">35px</span>', <span class="attr">zIndex:</span> <span class="attr">3</span>, <span class="attr">fontWeight:</span> <span class="attr">200</span>, <span class="attr">textAlign:</span> '<span class="attr">center</span>' &#125;&#125;&gt;</span>这是评论列表组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml">      &#123;this.state.CommentList.map(item =&gt; <span class="tag">&lt;<span class="name">CmtItem</span> &#123;<span class="attr">...item</span>&#125; <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">CmtItem</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">                                  </span><br><span class="line">#2.CmtItem组件</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一层封装：将 样式对象 和 UI 结构分离</span></span><br><span class="line"><span class="comment">// const itemStyle = &#123; border: '1px dashed #ccc', margin: '10px', padding: '10px', boxShadow: '0 0 10px #ccc' &#125;</span></span><br><span class="line"><span class="comment">// const userStyle = &#123; fontSize: '14px' &#125;</span></span><br><span class="line"><span class="comment">// const contentStyle = &#123; fontSize: '12px' &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二层封装：合并成一个大的样式对象</span></span><br><span class="line"><span class="comment">// const styles = &#123;</span></span><br><span class="line"><span class="comment">//   item: &#123; border: '1px dashed #ccc', margin: '10px', padding: '10px', boxShadow: '0 0 10px #ccc' &#125;,</span></span><br><span class="line"><span class="comment">//   user: &#123; fontSize: '14px' &#125;,</span></span><br><span class="line"><span class="comment">//   content: &#123; fontSize: '12px' &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三层封装：抽离为单独的 样式表 模块</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'@/components/styles'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">CmtItem</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;styles.item&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;styles.user&#125;</span>&gt;</span>评论人：&#123;props.user&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&#123;styles.content&#125;</span>&gt;</span>评论内容：&#123;props.content&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#3.styles.js </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  item: &#123; <span class="attr">border</span>: <span class="string">'1px dashed #ccc'</span>, <span class="attr">margin</span>: <span class="string">'10px'</span>, <span class="attr">padding</span>: <span class="string">'10px'</span>, <span class="attr">boxShadow</span>: <span class="string">'0 0 10px #ccc'</span> &#125;,</span><br><span class="line">  user: &#123; <span class="attr">fontSize</span>: <span class="string">'14px'</span> &#125;,</span><br><span class="line">  content: &#123; <span class="attr">fontSize</span>: <span class="string">'12px'</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-使用CSS样式表"><a href="#4-2-使用CSS样式表" class="headerlink" title="4.2 使用CSS样式表"></a>4.2 使用CSS样式表</h2><ol>
<li><p>修改 <code>webpack.config.js</code>这个配置文件，为 <code>css-loader</code> 添加参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install  style-loader  css-loader -D</span><br><span class="line"></span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>] &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建CmtList.css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.title</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在CmtList组件中<code>import</code>导入样式表，并接收模块化的 CSS 样式对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cssObj <span class="keyword">from</span> <span class="string">'../css/CmtList.css'</span> </span><br><span class="line"><span class="built_in">console</span>.log(cssObj)   <span class="comment">// 发现打印是空对象,因为它并不像js有模块化的导出</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在需要的HTML标签上，使用<code>className</code>指定模块化的样式：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这边不能&lt;h1 className=&#123;cssObj.title&#125;&gt;评论列表组件&lt;/h1&gt; 这样用，因为cssObj是空对象，但是在webpack打包后title会成为全局样式，所以可以直接使用className="title"</span></span><br><span class="line">&lt;h1 className=<span class="string">"title"</span>&gt;评论列表组件&lt;<span class="regexp">/h1&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>问题</p>
<blockquote>
<p>当我们在CmtList.css中指定了h1标签的样式的时候，我们发现  <code>import cssObj from &#39;../css/CmtList.css&#39;</code> 之后，CmtList和CmtItem中的h1标签都变成了倾斜，说明CmtList中的样式全局生效了。原因在于webpack进行打包的时候会将所有内容打包到一个js文件，所以打包后的样式会全局生效。</p>
</blockquote>
</li>
</ol>
<h2 id="4-3-使用CSS模块化"><a href="#4-3-使用CSS模块化" class="headerlink" title="4.3 使用CSS模块化"></a>4.3 使用CSS模块化</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#1. webpack.config.js  修改css的rules规则，开启css的模块化</span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: [<span class="string">'style-loader'</span>, <span class="string">'css-loader?modules'</span>] &#125;       <span class="comment">//modules表示为css启动模块化(启动模块化之后就有模块作用域)</span></span><br><span class="line"></span><br><span class="line">#2.修改CmtList.css</span><br><span class="line"><span class="comment">/* 注意： 被 :local() 包裹起来的类名会被模块化； 默认情况下所有的类和id选择器都会被模块化了； */</span></span><br><span class="line">.title&#123;</span><br><span class="line">  color: red;</span><br><span class="line">  text-align: center;</span><br><span class="line">  font-weight: <span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* css 模块化只针对类选择器 和 Id选择器生效， 不会对标签选择器模块化 */</span></span><br><span class="line">h1&#123;</span><br><span class="line">  font-style: italic;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* 注意：被 :global() 包裹起来的类名，不会被模块化，而是会全局生效； */</span> </span><br><span class="line">:global(.test)&#123;</span><br><span class="line">  font-style: italic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#3.CmtList组件</span><br><span class="line"><span class="keyword">import</span> cssObj <span class="keyword">from</span> <span class="string">'../css/CmtList.css'</span> </span><br><span class="line"><span class="built_in">console</span>.log(cssObj)   <span class="comment">// 发现开启css模块化之后，这边打印就有内容了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//所以在页面通过属性绑定指定样式</span></span><br><span class="line">&lt;h1 className=&#123;cssobj.title&#125;&gt;这是评论列表组件&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/如果要指定多个样式，可以像下面这样使用，其实就是className = &#123;'样式1'  '样式2'&#125;</span></span><br><span class="line"><span class="regexp">&lt;h1 className=&#123;[cssobj.title, 'test'].join(' ')&#125;&gt;这是评论列表组件&lt;/</span>h1&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4-4-CSS模块化注意事项"><a href="#4-4-CSS模块化注意事项" class="headerlink" title="4.4 CSS模块化注意事项"></a>4.4 CSS模块化注意事项</h2><ol>
<li><p>使用<code>localIdentName</code>自定义生成的类名格式，可选的参数有：</p>
<ul>
<li><p>[path]  表示样式表 <code>相对于项目根目录</code> 所在路径</p>
</li>
<li><p>[name]  表示 样式表文件名称</p>
</li>
<li><p>[local]  表示样式的类名定义名称</p>
</li>
<li><p>[hash:length]  表示32位的hash值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    loader: <span class="string">'style-loader'</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    loader: <span class="string">'css-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        <span class="comment">//'css-loader?modules'  表示开启css的模块化</span></span><br><span class="line">        modules: &#123;</span><br><span class="line">            <span class="comment">//path:表示原样式文件路径</span></span><br><span class="line">            <span class="comment">//name:表示原样式文件的名称</span></span><br><span class="line">            <span class="comment">//local:原样式的名称</span></span><br><span class="line">            <span class="comment">//hash:base64:5  : 使用hash的base64编码，保留5位</span></span><br><span class="line">            localIdentName: <span class="string">'[path][name]__[local]__[hash:base64:5]'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1562727326828.png"  alt="1562727326828"></p>
</li>
<li><p>使用 <code>:local()</code> 和 <code>:global()</code></p>
<ul>
<li><code>:local()</code>包裹的类名，是被模块化的类名，只能通过<code>className={cssObj.类名}</code>来使用。<code>:local</code>可以省略</li>
<li><code>:global()</code>包裹的类名，是全局生效的，不会被 <code>css-modules</code> 控制，定义的类名是什么，就是使用定义的类名<code>className=&quot;类名&quot;</code></li>
</ul>
</li>
<li><p>注意：只有<code>.title</code>这样的类样式或者id选择器，才会被模块化控制，类似于<code>body</code>这样的标签选择器，不会被模块化控制；</p>
</li>
</ol>
<h2 id="4-5-Bootstrap样式的使用"><a href="#4-5-Bootstrap样式的使用" class="headerlink" title="4.5 Bootstrap样式的使用"></a>4.5 Bootstrap样式的使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">npm install reactstrap bootstrap@<span class="number">4.0</span><span class="number">.0</span>  </span><br><span class="line">npm i url-loader file-loader --save-dev                   <span class="comment">//url加载器</span></span><br><span class="line"></span><br><span class="line">#CmtList.js中引入bootstrap样式</span><br><span class="line"><span class="keyword">import</span> bootcss <span class="keyword">from</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span></span><br><span class="line"></span><br><span class="line">#使用bootstrap样式</span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">'reactstrap'</span>;</span><br><span class="line">&lt;!--下面这样用不行，因为bootstrap的css样式被模块化了--&gt;</span><br><span class="line"> &lt;Button color=<span class="string">"primary"</span>&gt;primary&lt;<span class="regexp">/Button&gt;&#123;' '&#125;</span></span><br><span class="line"><span class="regexp">&lt;!--下面这样用才行--&gt;</span></span><br><span class="line"><span class="regexp">&lt;Button className=&#123;[bootcss.btn, bootcss['btn-primary']].join(' ')&#125;&gt;按钮&lt;/</span>Button&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>问题：如果都像上面那样使用bootstrap的样式，太麻烦了，我们期望引入bootstrap样式的时候还是<Button classname="btn btn-primary">按钮啊</Button> 这样用，解决方案如下：</p>
</blockquote>
<ol>
<li><p>把自己的样式表，定义为 <code>.less</code>文件</p>
</li>
<li><p>第三方的 样式表，还是 以 <code>.css</code> 结尾</p>
</li>
<li><p>我们只需要为自己的 .less文件，启用模块化即可；</p>
</li>
<li><p>运行<code>npm i less less-loader -D</code> 安装能够解析<code>less</code>文件的loader</p>
</li>
<li><p>添加loader规则：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给less文件开启模块化</span></span><br><span class="line">&#123;</span><br><span class="line">    test: /\.less$/,</span><br><span class="line">    use: [</span><br><span class="line">        &#123;</span><br><span class="line">            loader: 'style-loader'</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            loader: 'css-loader',</span><br><span class="line">            options: &#123;</span><br><span class="line">                modules: &#123;</span><br><span class="line">                    localIdentName: '[path][name]__[local]--[hash:base64:5]'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            loader:'less-loader'</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="5-webpack配置详解"><a href="#5-webpack配置详解" class="headerlink" title="5.webpack配置详解"></a>5.webpack配置详解</h1><blockquote>
<p>在实际开发中，一般会有两套项目方案：</p>
</blockquote>
<ul>
<li>一套是开发期间的项目，包含了测试文件、测试数据、开发工具、测试工具等相关配置，有利于项目的开发和测试，但是这些文件仅用于开发，发布项目时候需要剔除；</li>
<li>另一套是部署期间的项目，剔除了那些客户用不到的测试数据测试工具和文件，比较纯净，减少了项目发布后的体积，有利于安装和部署！</li>
</ul>
<h2 id="5-1-开发环境配置"><a href="#5-1-开发环境配置" class="headerlink" title="5.1 开发环境配置"></a>5.1 开发环境配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"># 1.安装</span><br><span class="line">npm init -y                                                       <span class="comment">//项目初始化</span></span><br><span class="line">npm install webpack@<span class="number">4.27</span><span class="number">.1</span> -d</span><br><span class="line">npm install webpack-cli -d       提供一些基本命令(比如webpack命令)</span><br><span class="line">npm install  webpack-dev-server -d</span><br><span class="line">npm i html-webpack-plugin@<span class="number">3.2</span><span class="number">.0</span> --save-dev</span><br><span class="line">npm install react react-dom -S</span><br><span class="line">npm i babel-core@<span class="number">6.26</span><span class="number">.3</span> babel-loader@<span class="number">7.1</span><span class="number">.5</span> babel-plugin-transform-runtime --save-dev</span><br><span class="line">npm i babel-preset-env babel-preset-stage<span class="number">-0</span> --save-dev</span><br><span class="line">npm i babel-preset-react -D</span><br><span class="line">npm install  style-loader  css-loader -D</span><br><span class="line">npm i less-loader less                                             <span class="comment">//less加载器</span></span><br><span class="line">npm i sass-loader node-sass --save-dev               <span class="comment">//sass加载器</span></span><br><span class="line">npm i url-loader file-loader --save-dev      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2.webpack.config.js</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>)</span><br><span class="line"><span class="keyword">var</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//webpack基于node构建的，所有用的是CommonJS模块化规范</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    entry: path.join(__dirname, <span class="string">'./src/main.js'</span>),</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        <span class="comment">// 表示，这几个文件的后缀名，可以省略不写</span></span><br><span class="line">        extensions: [<span class="string">'.js'</span>, <span class="string">'.jsx'</span>, <span class="string">'.json'</span>],</span><br><span class="line">        alias: &#123;</span><br><span class="line">            <span class="string">'@'</span>: path.join(__dirname, <span class="string">'./src'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// 添加plugins节点配置插件</span></span><br><span class="line">        <span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">'src/index.html'</span>),<span class="comment">//模板路径</span></span><br><span class="line">            filename: <span class="string">'index.html'</span><span class="comment">//自动生成的HTML文件的名称</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//热更新的</span></span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(), </span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123; <span class="comment">//要打包的第三方模块</span></span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            modules: &#123;</span><br><span class="line">                                localIdentName: <span class="string">'[path][name]__[local]--[hash:base64:5]'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'less-loader'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'style-loader'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            modules: &#123;</span><br><span class="line">                                localIdentName: <span class="string">'[path][name]__[local]--[hash:base64:5]'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'sass-loader'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.js|jsx$/</span>, <span class="attr">use</span>: <span class="string">'babel-loader'</span>, <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|gif|bmp|jpeg)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader?limit=1024&amp;name=[hash:8]-[name].[ext]'</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">test</span>: <span class="regexp">/\.(ttf|eot|svg|woff|woff2)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader'</span> &#125;, <span class="comment">// 处理 字体文件的 loader</span></span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        host: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">        open: <span class="literal">true</span>, <span class="comment">// 自动打开浏览器</span></span><br><span class="line">        port: <span class="number">3000</span>, <span class="comment">// 设置启动时候的运行端口</span></span><br><span class="line">        contentBase: <span class="string">'src'</span>, <span class="comment">// 指定托管的根目录</span></span><br><span class="line">        hot: <span class="literal">true</span> <span class="comment">// 启用热更新 的 第1步</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#3.项目入口文件  main.js</span><br><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./css/index.css'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// props.name = 'zs'     不论是 Vue 还是 React，组件中的 props 永远都是只读的；不能被重新赋值;</span></span><br><span class="line">    <span class="built_in">console</span>.log(props)</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>这是 Hello 组件 --- &#123;props.name&#125; --- &#123;props.age&#125; --- &#123;props.gender&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = &#123;</span><br><span class="line">    name: <span class="string">'大黄'</span>,</span><br><span class="line">    age: <span class="number">3</span>,</span><br><span class="line">    gender: <span class="string">'雄'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;/* 使用&#123;...obj&#125;属性扩散传递数据 */&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Hello</span> &#123;<span class="attr">...dog</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">Hello</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br><span class="line"></span><br><span class="line">#4.index.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br><span class="line"><span class="regexp">                </span></span><br><span class="line"><span class="regexp">#5.css/i</span>ndex.css</span><br><span class="line">div&#123;</span><br><span class="line">    border: <span class="number">1</span>px solid red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.box&#123;</span><br><span class="line">    width: <span class="number">300</span>px;</span><br><span class="line">    height: <span class="number">500</span>px;</span><br><span class="line">    background: url(<span class="string">"../images/1.jpg"</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">#6.package.json</span><br><span class="line"> <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --open --port 3000 --contentBase src --hot"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">#7.项目根目录 .babelrc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [<span class="string">"env"</span>, <span class="string">"stage-0"</span>, <span class="string">"react"</span>],</span><br><span class="line">  <span class="string">"plugins"</span>: [<span class="string">"transform-runtime"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-生产环境配置文件"><a href="#5-2-生产环境配置文件" class="headerlink" title="5.2 生产环境配置文件"></a>5.2 生产环境配置文件</h2><h3 id="a-创建生产环境的配置文件"><a href="#a-创建生产环境的配置文件" class="headerlink" title="a) 创建生产环境的配置文件"></a>a) 创建生产环境的配置文件</h3><p>为了满足我们的发布策略，需要新建一个配置文件，命名为<code>webpack.publish.config.js</code>，将<code>webpack.config.js</code>的配置拷贝过去，剔除一些开发配置项即可：</p>
<ul>
<li>将<code>devServer</code>节点和热更新插件删掉：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    port: <span class="number">4321</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br></pre></td></tr></table></figure>

<ol>
<li>修改<code>url-loader</code>，将图片放入统一的images文件夹之下(<strong>图片路径写在css文件中才会被打包，如果直接写在行内样式里面，不会被打包</strong>)：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|gif)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader?limit=5000&amp;name=images/[hash:8]-[name].[ext]'</span> &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在<code>package.json</code>中的script节点下新增<code>dev</code>命令，通过<code>--config</code>指定webpack启动时要读取的配置文件：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"pub"</span>: <span class="string">"webpack --config webpack.publish.config.js"</span></span><br></pre></td></tr></table></figure>

<h3 id="b-每次重新构建时候删除dist目录"><a href="#b-每次重新构建时候删除dist目录" class="headerlink" title="b) 每次重新构建时候删除dist目录"></a>b) 每次重新构建时候删除dist目录</h3><ol>
<li>运行<code>npm i clean-webpack-plugin --save-dev</code></li>
<li>在头部引入这个插件：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在<code>plugins</code>节点下使用这个插件：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> CleanWebpackPlugin ()</span><br></pre></td></tr></table></figure>

<h3 id="c-分离第三方包"><a href="#c-分离第三方包" class="headerlink" title="c) 分离第三方包"></a>c) 分离第三方包</h3><ol>
<li>和plugins节点平级添加下面配置：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            cacheGroups: &#123;</span><br><span class="line">                <span class="comment">//自己写的代码打包 一个文件</span></span><br><span class="line">                commons: &#123;</span><br><span class="line">                    name: <span class="string">"commons"</span>,</span><br><span class="line">                    chunks: <span class="string">"initial"</span>,</span><br><span class="line">                    <span class="comment">//在分割之前，这个代码块最小应该被引用的次数</span></span><br><span class="line">                    minChunks: <span class="number">1</span>,</span><br><span class="line">                    <span class="comment">//形成一个新代码块最小的体积</span></span><br><span class="line">                    minSize: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//node_modules代码打包 一个文件</span></span><br><span class="line">                vendor: &#123;</span><br><span class="line">                    chunks: <span class="string">"all"</span>,</span><br><span class="line">                    test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    name: <span class="string">"vendor"</span>,</span><br><span class="line">                    minChunks: <span class="number">1</span>,</span><br><span class="line">                    <span class="comment">//入口最大的并行请求数</span></span><br><span class="line">                    maxInitialRequests: <span class="number">5</span>,</span><br><span class="line">                    <span class="comment">// //形成一个新代码块最小的体积</span></span><br><span class="line">                    minSize: <span class="number">0</span>,</span><br><span class="line">                    <span class="comment">//缓存组打包的先后优先级</span></span><br><span class="line">                    priority: <span class="number">100</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p><code>html-webpack-plugin</code>在生成<code>index.html</code>文件的时候，会自动将抽离的第三方包引入进去！</p>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1553329256785.png"  alt="1553329256785"></p>
</li>
</ol>
<h3 id="d-优化压缩HTML文件"><a href="#d-优化压缩HTML文件" class="headerlink" title="d) 优化压缩HTML文件"></a>d) 优化压缩HTML文件</h3><p>在<code>plugins</code>节点下的<code>htmlWebpackPlugin</code>插件中，添加<code>minify</code>子节点：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">    template: path.join(__dirname, <span class="string">'./src/index.html'</span>),</span><br><span class="line">    filename: <span class="string">'index.html'</span>,</span><br><span class="line">    <span class="comment">//压缩合并html页面</span></span><br><span class="line">    minify: &#123;</span><br><span class="line">        collapseWhitespace: <span class="literal">true</span>, <span class="comment">// 合并多余的空格</span></span><br><span class="line">        removeComments: <span class="literal">true</span>, <span class="comment">// 移除注释</span></span><br><span class="line">        removeAttributeQuotes: <span class="literal">true</span> <span class="comment">// 移除 属性上的双引号</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<p>其他优化项请参考：<a href="https://github.com/kangax/html-minifier#options-quick-reference" target="_blank" rel="noopener">html-minifier - github</a></p>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1553150762968.png"  alt="1553150762968"></p>
<h3 id="e-抽取bundle-js中的CSS到指定文件"><a href="#e-抽取bundle-js中的CSS到指定文件" class="headerlink" title="e) 抽取bundle.js中的CSS到指定文件"></a>e) 抽取bundle.js中的CSS到指定文件</h3><ol>
<li>运行<code>npm install extract-text-webpack-plugin@next</code>安装抽取CSS文件的插件。</li>
<li>在配置文件中导入插件：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改CSS和Sass的loader如下：</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: /\.css$/, use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">        fallback: "style-loader",</span><br><span class="line">        use: ["css-loader"],</span><br><span class="line">        publicPath: '../'         // 设置css背景图片的路径</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: /\.scss$/, use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">        fallback: "style-loader",</span><br><span class="line">        use: [</span><br><span class="line">            &#123;</span><br><span class="line">                loader: 'css-loader',</span><br><span class="line">                options: &#123;</span><br><span class="line">                    modules: &#123;</span><br><span class="line">                        localIdentName: '[path][name]__[local]--[hash:base64:5]'</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                loader: 'sass-loader',</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        publicPath: '../'         // 设置css背景图片的路径</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: /\.less$/, use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">        fallback: "style-loader",</span><br><span class="line">        use: [</span><br><span class="line">            &#123;</span><br><span class="line">                loader: 'css-loader',</span><br><span class="line">                options: &#123;</span><br><span class="line">                    modules: &#123;</span><br><span class="line">                        localIdentName: '[path][name]__[local]--[hash:base64:5]'</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                loader: 'less-loader',</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        publicPath: '../'         // 设置css背景图片的路径</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在plugins节点下新增插件：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ExtractTextPlugin(<span class="string">"css/styles.css"</span>), <span class="comment">// 抽取CSS文件的插件</span></span><br></pre></td></tr></table></figure>

<h3 id="f-压缩抽取出来的CSS文件"><a href="#f-压缩抽取出来的CSS文件" class="headerlink" title="f) 压缩抽取出来的CSS文件"></a>f) 压缩抽取出来的CSS文件</h3><p><a href="https://github.com/NMFR/optimize-css-assets-webpack-plugin" target="_blank" rel="noopener">https://github.com/NMFR/optimize-css-assets-webpack-plugin</a></p>
<ol>
<li>运行<code>npm i optimize-css-assets-webpack-plugin --save-dev</code>安装插件到开发依赖。</li>
<li>在配置文件头部导入插件：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在plugins节点下新增插件：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> OptimizeCssAssetsPlugin() <span class="comment">// 压缩CSS文件的插件</span></span><br></pre></td></tr></table></figure>

<h3 id="g-生产环境配置文件总结"><a href="#g-生产环境配置文件总结" class="headerlink" title="g) 生产环境配置文件总结"></a>g) 生产环境配置文件总结</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"># 新建webpack.pub.config.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//生产环境</span></span><br><span class="line">    mode:<span class="string">"production"</span>,</span><br><span class="line">    entry: path.join(__dirname, <span class="string">'./src/main.js'</span>),</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [ </span><br><span class="line">        <span class="comment">// 添加plugins节点配置插件</span></span><br><span class="line">        <span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">            template:path.resolve(__dirname, <span class="string">'src/index.html'</span>),<span class="comment">//模板路径</span></span><br><span class="line">            filename:<span class="string">'index.html'</span>,<span class="comment">//自动生成的HTML文件的名称</span></span><br><span class="line">            <span class="comment">//压缩合并html页面</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>, <span class="comment">// 合并多余的空格</span></span><br><span class="line">                removeComments: <span class="literal">true</span>, <span class="comment">// 移除注释</span></span><br><span class="line">                removeAttributeQuotes: <span class="literal">true</span> <span class="comment">// 移除属性上的双引号</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//每次发布项目的时候自动清除之前的dist目录</span></span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin (),</span><br><span class="line">        <span class="keyword">new</span> ExtractTextPlugin(<span class="string">"css/styles.css"</span>),</span><br><span class="line">        <span class="keyword">new</span> OptimizeCssAssetsPlugin() <span class="comment">// 压缩CSS文件的插件</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123; </span><br><span class="line">        rules: [</span><br><span class="line">          &#123; <span class="attr">test</span>: <span class="regexp">/\.(ttf|eot|svg|woff|woff2)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader'</span> &#125;, </span><br><span class="line">          &#123; <span class="attr">test</span>: <span class="regexp">/\.js|jsx$/</span>, <span class="attr">use</span>: <span class="string">'babel-loader'</span>, <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: ExtractTextPlugin.extract(&#123;</span><br><span class="line">                fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">                use: [<span class="string">"css-loader"</span>],</span><br><span class="line">                publicPath: <span class="string">'../'</span>         <span class="comment">// 设置css背景图片的路径</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            test: <span class="regexp">/\.scss$/</span>, <span class="attr">use</span>: ExtractTextPlugin.extract(&#123;</span><br><span class="line">                fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            modules: &#123;</span><br><span class="line">                            localIdentName: <span class="string">'[path][name]__[local]--[hash:base64:5]'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'sass-loader'</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                publicPath: <span class="string">'../'</span>         <span class="comment">// 设置css背景图片的路径</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            test: <span class="regexp">/\.less$/</span>, <span class="attr">use</span>: ExtractTextPlugin.extract(&#123;</span><br><span class="line">                fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            modules: &#123;</span><br><span class="line">                            localIdentName: <span class="string">'[path][name]__[local]--[hash:base64:5]'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'less-loader'</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                publicPath: <span class="string">'../'</span>         <span class="comment">// 设置css背景图片的路径</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;,</span><br><span class="line"></span><br><span class="line">          <span class="comment">//name=images/[hash:8]-[name].[ext]   发布项目的时候把图片都放到images文件夹下面去</span></span><br><span class="line">          &#123; <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|gif|bmp|jpeg)$/</span>, <span class="attr">use</span>: <span class="string">'url-loader?limit=1024&amp;name=images/[hash:8]-[name].[ext]'</span> &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [<span class="string">'.js'</span>, <span class="string">'.jsx'</span>, <span class="string">'.json'</span>], <span class="comment">// 表示这几个文件的后缀名，可以省略不写</span></span><br><span class="line">        alias: &#123;</span><br><span class="line">            <span class="string">'@'</span>: path.join(__dirname, <span class="string">'./src'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        <span class="comment">//分割代码块</span></span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            cacheGroups: &#123;</span><br><span class="line">                <span class="comment">//创建一个commons块，包含入口点共享的所有代码</span></span><br><span class="line">                commons: &#123;</span><br><span class="line">                    name: <span class="string">"commons"</span>,</span><br><span class="line">                    chunks: <span class="string">"initial"</span>,</span><br><span class="line">                    <span class="comment">//在分割之前，这个代码块最小应该被引用的次数</span></span><br><span class="line">                    minChunks: <span class="number">1</span>,</span><br><span class="line">                    <span class="comment">//形成一个新代码块最小的体积</span></span><br><span class="line">                    minSize: <span class="number">0</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//node_modules代码打包 一个文件</span></span><br><span class="line">                vendor: &#123;</span><br><span class="line">                    chunks: <span class="string">"all"</span>,</span><br><span class="line">                    test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    name: <span class="string">"vendor"</span>,</span><br><span class="line">                    minChunks: <span class="number">1</span>,</span><br><span class="line">                    <span class="comment">//形成一个新代码块最小的体积</span></span><br><span class="line">                    minSize: <span class="number">0</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#package.json中新增</span><br><span class="line"> <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --open --port 3000 --contentBase src --hot"</span>,</span><br><span class="line">    <span class="string">"pub"</span>: <span class="string">"webpack --config webpack.publish.config.js"</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-React-事件处理"><a href="#6-React-事件处理" class="headerlink" title="6. React 事件处理"></a>6. React 事件处理</h1><p><a href="https://reactjs.org/docs/events.html" target="_blank" rel="noopener">https://reactjs.org/docs/events.html</a></p>
<h2 id="6-1-事件绑定"><a href="#6-1-事件绑定" class="headerlink" title="6.1 事件绑定"></a>6.1 事件绑定</h2><ol>
<li><p>事件的名称都是React的提供的，因此名称的首字母必须大写<code>onClick</code>、<code>onMouseOver</code></p>
</li>
<li><p>为事件提供的处理函数，必须是如下格式 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123; <span class="function"><span class="keyword">function</span> &#125;&gt;按钮&lt;/<span class="title">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>事件绑定方式：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#1.方式1：普通函数绑定</span><br><span class="line">&lt;button onClick=&#123; <span class="keyword">this</span>.show &#125;&gt;按钮&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 事件的处理函数，需要定义为 一个箭头函数，然后赋值给 函数名称</span></span><br><span class="line"><span class="regexp">function show()&#123;</span></span><br><span class="line"><span class="regexp">    console.log("show方法")</span></span><br><span class="line"><span class="regexp">    console.log(this)   /</span><span class="regexp">/undefined</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">#2.方式2：箭头函数绑定(此种方式用的比较多)</span></span><br><span class="line"><span class="regexp">&lt;button onClick=&#123; () =&gt; this.show('传参') &#125;&gt;按钮&lt;/</span>button&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件的处理函数，需要定义为 一个箭头函数，然后赋值给函数名称</span></span><br><span class="line">show = <span class="function">(<span class="params">arg1</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'show方法'</span> + arg1)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)   <span class="comment">//当前组件对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<blockquote>
<p>注意点：</p>
<p>1.在react中，箭头函数中的this就代表当前的组件对象，因为箭头函数的this其实质是定义函数时所在作用域中的this。</p>
<p>2.在react中，普通函数中的this是undefined。</p>
</blockquote>
<h2 id="6-2-修改事件的this并传递参数"><a href="#6-2-修改事件的this并传递参数" class="headerlink" title="6.2 修改事件的this并传递参数"></a>6.2 修改事件的this并传递参数</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#方式1：使用bind修改普通函数中的this指向</span><br><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">message</span>: <span class="string">'Allo!'</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleClick (name, e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.message + name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123; <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>, <span class="string">'赵四'</span>) &#125;&gt;Say Hello&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#方式2.在构造函数中通过bind修改this指向，返回新函数，然后在render中使用修改this指向后的新函数</span><br><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">message</span>: <span class="string">'Allo!'</span>&#125;</span><br><span class="line">        <span class="keyword">this</span>.handleClick = <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleClick (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.message)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123; <span class="keyword">this</span>.handleClick &#125;&gt;Say Hello&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#方式3：使用箭头函数</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">message</span>: <span class="string">'Allo!'</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleClick = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.message)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render () &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123; <span class="keyword">this</span>.handleClick &#125;&gt;Say Hello&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#注意：第二种和第三种方式如果这样用，&lt;button onClick=&#123; this.handleClick() &#125;&gt;Say Hello&lt;/button&gt; ，此时会直接调用handleClick函数。如果想要点击按钮的时候才触发handleClick方法并且要给this.handleClick函数中传递参数，可以使用箭头函数&lt;button onClick=&#123; ()=&gt;&#123;this.handleClick('aa','bb')&#125; &#125;&gt;Say Hello&lt;/button&gt;。但一旦使用了箭头函数，那么箭头函数中的this就已经指向了当前的组件对象</span><br></pre></td></tr></table></figure>

<h2 id="6-3-绑定文本框与state中的值"><a href="#6-3-绑定文本框与state中的值" class="headerlink" title="6.3 绑定文本框与state中的值"></a>6.3 绑定文本框与state中的值</h2><ol>
<li><p>在Vue中提供了<code>v-model</code>指令，可以很方便的实现 <code>数据的双向绑定</code>；</p>
</li>
<li><p>但是在React中只是<code>单向数据流</code>，也就是只能把state上的数据绑定到页面，无法把页面中数据的变化自动同步回 state ； 如果需要把页面上数据的变化保存到 state，则需要程序员手动监听<code>onChange</code>事件，拿到最新的数据，手动调用<code>this.setState({  })</code> 更改回去。 这种方式叫受控组件</p>
</li>
</ol>
<h3 id="6-3-1-表单受控组件"><a href="#6-3-1-表单受控组件" class="headerlink" title="6.3.1 表单受控组件"></a>6.3.1 表单受控组件</h3><p>在 HTML 中，表单元素（如<code>&lt;input&gt;</code>、 <code>&lt;textarea&gt;</code> 和 <code>&lt;select&gt;</code>）之类的表单元素通常自己维护 state，并根据用户输入进行更新。而在 React 中，可变状态（mutable state）通常保存在组件的 state 属性中，并且只能通过使用 <a href="https://zh-hans.reactjs.org/docs/react-component.html#setstate" target="_blank" rel="noopener"><code>setState()</code></a>来更新。</p>
<p>我们可以把两者结合起来，使 React 的 state 成为“唯一数据源”。渲染表单的 React 组件还控制着用户输入过程中表单发生的操作。被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果文本框没有指定onChange事件，那么该文本框是只读的，不可以修改</span></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;input value=<span class="string">"this.state.value"</span> onChange=&#123;<span class="keyword">this</span>.inputChange&#125;/&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inputChange = <span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123;<span class="attr">value</span>: e.target.value&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="6-3-2-表单非受控组件"><a href="#6-3-2-表单非受控组件" class="headerlink" title="6.3.2 表单非受控组件"></a>6.3.2 表单非受控组件</h3><p>在大多数情况下，我们推荐使用 <a href="https://zh-hans.reactjs.org/docs/forms.html#controlled-components" target="_blank" rel="noopener">受控组件</a> 来处理表单数据。在一个受控组件中，表单数据是由 React 组件来管理的。另一种替代方案是使用非受控组件，这时表单数据将交由 DOM 节点来处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.handleSubmit = <span class="keyword">this</span>.handleSubmit.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.input = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleSubmit(event) &#123;</span><br><span class="line">    alert(<span class="string">'A name was submitted: '</span> + <span class="keyword">this</span>.input.current.value);</span><br><span class="line">    event.preventDefault();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;form onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          Name:</span><br><span class="line">          &lt;input type=<span class="string">"text"</span> ref=&#123;<span class="keyword">this</span>.input&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input type="submit" value="Submit" /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>因为非受控组件将真实数据储存在 DOM 节点中，所以在使用非受控组件时，有时候反而更容易同时集成 React 和非 React 代码。如果你不介意代码美观性，并且希望快速编写代码，使用非受控组件往往可以减少你的代码量。否则，你应该使用受控组件。</p>
<h3 id="6-3-3-受控组件和非受控组件"><a href="#6-3-3-受控组件和非受控组件" class="headerlink" title="6.3.3 受控组件和非受控组件"></a>6.3.3 受控组件和非受控组件</h3><p>“受控”和“不受控制”的术语通常指的是表单输入，但他们还可以描述任何组件数据的位置。作为props传递进组件的数据可以被认为是<strong>受控的</strong>（因为父组件控制数据）。只存在于内部状态的数据可以被认为是<strong>不受控制的</strong>（因为父类不能直接更改它）。</p>
<h2 id="6-4-React-createRef"><a href="#6-4-React-createRef" class="headerlink" title="6.4 React.createRef"></a>6.4 React.createRef</h2><h3 id="6-4-1-为dom元素添加ref"><a href="#6-4-1-为dom元素添加ref" class="headerlink" title="6.4.1 为dom元素添加ref"></a>6.4.1 为dom元素添加ref</h3><p><code>React.createRef</code> 创建一个能够通过 ref 属性附加到 React 元素的 <a href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html" target="_blank" rel="noopener">ref</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">// 创造一个 textInput DOM 元素的 ref</span></span><br><span class="line">    <span class="keyword">this</span>.textInput = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">"text"</span></span><br><span class="line">        ref=&#123;<span class="keyword">this</span>.textInput&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// 使用原始的 DOM API 显式地聚焦在 text input 上</span></span><br><span class="line">   <span class="comment">// 注意：我们通过访问 “current” 来获得 DOM 节点</span></span><br><span class="line">   <span class="keyword">this</span>.textInput.current.focus();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>React 会在组件挂载时给 <code>current</code> 属性传入 DOM 元素，并在组件卸载时传入 <code>null</code> 值。<code>ref</code> 会在 <code>componentDidMount</code> 或 <code>componentDidUpdate</code> 生命周期钩子触发前更新。</p>
<h3 id="6-4-2-为class组件添加ref"><a href="#6-4-2-为class组件添加ref" class="headerlink" title="6.4.2 为class组件添加ref"></a>6.4.2 为class组件添加ref</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoFocusTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.textInput = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.textInput.current.focusTextInput();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;CustomTextInput ref=&#123;<span class="keyword">this</span>.textInput&#125; /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">// 创建一个 ref 来存储 textInput 的 DOM 元素</span></span><br><span class="line">    <span class="keyword">this</span>.textInput = React.createRef();</span><br><span class="line">    <span class="keyword">this</span>.focusTextInput = <span class="keyword">this</span>.focusTextInput.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  focusTextInput() &#123;</span><br><span class="line">    <span class="comment">// 直接使用原生 API 使 text 输入框获得焦点</span></span><br><span class="line">    <span class="comment">// 注意：我们通过 "current" 来访问 DOM 节点</span></span><br><span class="line">    <span class="keyword">this</span>.textInput.current.focus();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// 告诉 React 我们想把 &lt;input&gt; ref 关联到</span></span><br><span class="line">    <span class="comment">// 构造器里创建的 `textInput` 上</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"text"</span></span><br><span class="line">          ref=&#123;<span class="keyword">this</span>.textInput&#125; /&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"button"</span></span><br><span class="line">          value=<span class="string">"Focus the text input"</span></span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.focusTextInput&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-3-函数组件与ref"><a href="#6-4-3-函数组件与ref" class="headerlink" title="6.4.3 函数组件与ref"></a>6.4.3 函数组件与ref</h3><p>默认情况下，<strong>你不能在函数组件上使用 ref 属性</strong>，因为它们没有实例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyFunctionComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.textInput = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// This will *not* work!</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;MyFunctionComponent ref=&#123;<span class="keyword">this</span>.textInput&#125; /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-4-ref转发"><a href="#6-4-4-ref转发" class="headerlink" title="6.4.4 ref转发"></a>6.4.4 ref转发</h3><p>如果要在函数组件中使用 <code>ref</code>，你可以使用 <a href="https://zh-hans.reactjs.org/docs/forwarding-refs.html" target="_blank" rel="noopener"><code>forwardRef</code></a>，或者可以将该组件转化为 class 组件。</p>
<p>Ref 转发是一个可选特性，其允许某些组件接收 ref，并将其向下传递（换句话说，“转发”它）给子组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> FancyButton = React.forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> (</span><br><span class="line">  &lt;button ref=&#123;ref&#125; className=<span class="string">"FancyButton"</span>&gt;</span><br><span class="line">    &#123;props.children&#125;</span><br><span class="line">  &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 你可以直接获取 DOM button 的 ref：</span></span><br><span class="line"><span class="regexp">const ref = React.createRef();</span></span><br><span class="line"><span class="regexp">&lt;FancyButton ref=&#123;ref&#125;&gt;Click me!&lt;/</span>FancyButton&gt;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    以下是对上述示例发生情况的逐步解释：</span></span><br><span class="line"><span class="comment">1.我们通过调用 React.createRef 创建了一个 React ref 并将其赋值给 ref 变量。</span></span><br><span class="line"><span class="comment">2.我们通过指定 ref 为 JSX 属性，将其向下传递给 &lt;FancyButton ref=&#123;ref&#125;&gt;。</span></span><br><span class="line"><span class="comment">3.React 传递 ref 给 fowardRef 内函数 (props, ref) =&gt; ...，作为其第二个参数。</span></span><br><span class="line"><span class="comment">4.我们向下转发该 ref 参数到 &lt;button ref=&#123;ref&#125;&gt;，将其指定为 JSX 属性。</span></span><br><span class="line"><span class="comment">5.当 ref 挂载完成，ref.current 将指向 &lt;button&gt; DOM 节点。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="6-5-ref回调"><a href="#6-5-ref回调" class="headerlink" title="6.5 ref回调"></a>6.5 ref回调</h2><h3 id="6-5-1-基本使用"><a href="#6-5-1-基本使用" class="headerlink" title="6.5.1 基本使用"></a>6.5.1 基本使用</h3><p>不同于传递 <code>createRef()</code> 创建的 <code>ref</code> 属性，你会传递一个函数。这个函数中接受 React 组件实例或 HTML DOM 元素作为参数，以使它们能在其他地方被存储和访问。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.textInput = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setTextInputRef = <span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.textInput = element;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.focusTextInput = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 使用原生 DOM API 使 text 输入框获得焦点</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.textInput) <span class="keyword">this</span>.textInput.focus();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="comment">// 组件挂载后，让文本框自动获得焦点</span></span><br><span class="line">    <span class="keyword">this</span>.focusTextInput();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// 使用 `ref` 的回调函数将 text 输入框 DOM 节点的引用存储到 React</span></span><br><span class="line">    <span class="comment">// 实例上（比如 this.textInput）</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"text"</span></span><br><span class="line">          ref=&#123;<span class="keyword">this</span>.setTextInputRef&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          type=<span class="string">"button"</span></span><br><span class="line">          value=<span class="string">"Focus the text input"</span></span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.focusTextInput&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>React 将在组件挂载时，会调用 <code>ref</code> 回调函数并传入 DOM 元素，当卸载时调用它并传入 <code>null</code>。在 <code>componentDidMount</code> 或 <code>componentDidUpdate</code> 触发前，React 会保证 refs 一定是最新的</p>
<h3 id="6-5-2-父子之间传递回调ref"><a href="#6-5-2-父子之间传递回调ref" class="headerlink" title="6.5.2 父子之间传递回调ref"></a>6.5.2 父子之间传递回调ref</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomTextInput</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input ref=&#123;props.inputRef&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Parent extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;CustomTextInput</span></span><br><span class="line"><span class="regexp">        inputRef=&#123;el =&gt; this.inputElement = el&#125;</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的例子中，<code>Parent</code> 把它的 refs 回调函数当作 <code>inputRef</code> props 传递给了 <code>CustomTextInput</code>，而且 <code>CustomTextInput</code> 把相同的函数作为特殊的 <code>ref</code> 属性传递给了 <code>&lt;input&gt;</code>。结果是，在 <code>Parent</code> 中的 <code>this.inputElement</code> 会被设置为与 <code>CustomTextInput</code> 中的 <code>input</code> 元素相对应的 DOM 节点。</p>
<h2 id="6-6-过时-API：String-类型的-Refs"><a href="#6-6-过时-API：String-类型的-Refs" class="headerlink" title="6.6 过时 API：String 类型的 Refs"></a>6.6 过时 API：String 类型的 Refs</h2><p>如果你之前使用过 React，你可能了解过之前的 API 中的 string 类型的 ref 属性，例如 <code>&quot;textInput&quot;</code>。你可以通过 <code>this.refs.textInput</code> 来访问 DOM 节点。我们不建议使用它，因为 string 类型的 refs 存在 <a href="https://github.com/facebook/react/pull/8333#issuecomment-271648615" target="_blank" rel="noopener">一些问题</a>。它已过时并可能会在未来的版本被移除。</p>
<h1 id="7-React组件的通信"><a href="#7-React组件的通信" class="headerlink" title="7 React组件的通信"></a>7 React组件的通信</h1><h2 id="7-1-父子组件的通信"><a href="#7-1-父子组件的通信" class="headerlink" title="7.1 父子组件的通信"></a>7.1 父子组件的通信</h2><h3 id="a-父组件传递给子组件"><a href="#a-父组件传递给子组件" class="headerlink" title="a) 父组件传递给子组件"></a>a) 父组件传递给子组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line">&lt;CMTItem key=&#123;i&#125; &#123;...item&#125;&lt;<span class="regexp">/CMTItem&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/子组件通过this.props可以获取到父组件传递过来的数据</span></span><br></pre></td></tr></table></figure>

<h3 id="b-子组件传递给父组件"><a href="#b-子组件传递给父组件" class="headerlink" title="b) 子组件传递给父组件"></a>b) 子组件传递给父组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line"> &lt;CMTBox reload=&#123;<span class="keyword">this</span>.loadCmts&#125;&gt;&lt;<span class="regexp">/CMTBox&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/子组件通过this.props.reload() 来调用父组件的方法，调用的时候可以传递参数</span></span><br></pre></td></tr></table></figure>

<h3 id="c-评论列表发表评论"><a href="#c-评论列表发表评论" class="headerlink" title="c) 评论列表发表评论"></a>c) 评论列表发表评论</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">#1.CmtList.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> CmtItem <span class="keyword">from</span> <span class="string">'./cmtItem'</span></span><br><span class="line"><span class="keyword">import</span> CmtBox <span class="keyword">from</span> <span class="string">'./cmtBox'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">CmtList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            list: [</span><br><span class="line">                &#123; <span class="attr">user</span>: <span class="string">'zs'</span>, <span class="attr">content</span>: <span class="string">'123'</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">user</span>: <span class="string">'ls'</span>, <span class="attr">content</span>: <span class="string">'qqq'</span> &#125;,</span><br><span class="line">                &#123; <span class="attr">user</span>: <span class="string">'xiaohong'</span>, <span class="attr">content</span>: <span class="string">'www'</span> &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    reload = <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="function">(<span class="params">prev</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">list</span>: [...prev.list, obj] &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是评论列表组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line"><span class="xml">                this.state.list.map(item =&gt; (</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">CmtItem</span> <span class="attr">key</span>=<span class="string">&#123;item.user&#125;</span> &#123;<span class="attr">...item</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">CmtItem</span>&gt;</span></span></span><br><span class="line"><span class="xml">                ))</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">CmtBox</span> <span class="attr">reload</span>=<span class="string">&#123;this.reload&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">CmtBox</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#2.CmtItem.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">border:</span> '<span class="attr">1px</span> <span class="attr">solid</span> #<span class="attr">ccc</span>', <span class="attr">margin:</span> '<span class="attr">10px</span> <span class="attr">0</span>' &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>评论人：&#123;props.user&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>评论内容：&#123;props.content&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#3.CmtBox.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">CmtBox</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            user:<span class="string">""</span>,</span><br><span class="line">            content:<span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操作的是哪个文本框就去修改哪个文本框的数据</span></span><br><span class="line">    changeHandler = <span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> tag = e.currentTarget.id;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            [tag]:e.currentTarget.value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    postComment = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.state.user &amp;&amp; <span class="keyword">this</span>.state.content)&#123;</span><br><span class="line">            <span class="keyword">this</span>.props.reload(&#123;</span><br><span class="line">                user: <span class="keyword">this</span>.state.user,</span><br><span class="line">                content: <span class="keyword">this</span>.state.content</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">this</span>.state.user = <span class="keyword">this</span>.state.content = <span class="string">""</span> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"user"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">&#123;this.state.user&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.changeHandler&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"content"</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">&#123;this.state.content&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.changeHandler&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"发表评论"</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.postComment()&#125; /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-2-使用Context实现跨组件通信"><a href="#7-2-使用Context实现跨组件通信" class="headerlink" title="7.2 使用Context实现跨组件通信"></a>7.2 使用Context实现跨组件通信</h2><p>当你不想在组件树中通过逐层传递 <code>props</code>或者<code>state</code>的方式来传递数据时，可以使用<code>Context</code>来实现<strong>跨层级</strong>的组件数据传递。</p>
<h3 id="a-父子组件传递数据的方式"><a href="#a-父子组件传递数据的方式" class="headerlink" title="a) 父子组件传递数据的方式"></a>a) 父子组件传递数据的方式</h3><p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1553135155547.png"  alt="1553135155547"></p>
<h3 id="b-使用Context跨级传递数据"><a href="#b-使用Context跨级传递数据" class="headerlink" title="b) 使用Context跨级传递数据"></a>b) 使用Context跨级传递数据</h3><p><img src="/" class="lazyload" data-src="/2019/09/27/React/assets%5C1553135231745.png"  alt="1553135231745"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个Context对象</span></span><br><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(<span class="string">"light"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextComp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="comment">//ThemeContext.Provider 数据的提供者，允许消费组件订阅context的变化</span></span><br><span class="line">        <span class="comment">//value就是给子组件暴露的数据</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;name:</span>"<span class="attr">zhangsan</span>"&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ThemedButton</span>&gt;</span><span class="tag">&lt;/<span class="name">ThemedButton</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemedButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">//这能让你使用 this.context 来消费最近 Context 上的那个值</span></span><br><span class="line">    <span class="keyword">static</span> contextType = ThemeContext;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Content</span>&gt;</span><span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>&#123;this.context.name&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ThemeContext.Consumer 允许我们在函数组件中使用Context</span></span><br><span class="line"><span class="comment">//ThemeContext.Consumer中的箭头函数的入参就是最近一个Provider所暴露的数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Content</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">ThemeContext.Consumer</span>&gt;</span>&#123;</span></span><br><span class="line"><span class="xml">        obj =&gt; &#123;</span></span><br><span class="line"><span class="xml">            return <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;obj.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">    &#125;<span class="tag">&lt;/<span class="name">ThemeContext.Consumer</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-3-使用自定义事件实现组件通讯"><a href="#7-3-使用自定义事件实现组件通讯" class="headerlink" title="7.3 使用自定义事件实现组件通讯"></a>7.3 使用自定义事件实现组件通讯</h2><p>在没有嵌套关系的组件中，我们可以使用自定义事件的方式实现组件通信。</p>
<blockquote>
<p>1.在componentDidMount事件中，订阅事件</p>
<p>2.在组件卸载的时候，在componentWillUnmount事件中取消事件的订阅;</p>
<p>3.以常用的发布/订阅模式，借用Node.js Events模块的浏览器版实现</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install events --save</span><br></pre></td></tr></table></figure>

<p>在src下新建一个util目录里面建一个events.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; EventEmitter &#125; <span class="keyword">from</span> <span class="string">'events'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> EventEmitter();</span><br></pre></td></tr></table></figure>

<p>list1.jsx</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> emitter <span class="keyword">from</span> <span class="string">'../util/events'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            message: <span class="string">'List1'</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="comment">// 组件装载完成以后声明一个自定义事件</span></span><br><span class="line">        <span class="keyword">this</span>.eventEmitter = emitter.addListener(<span class="string">'changeMessage'</span>, (message) =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                message,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        emitter.removeListener(<span class="keyword">this</span>.eventEmitter);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;<span class="keyword">this</span>.state.message&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default List;</span></span><br></pre></td></tr></table></figure>

<p>List2.jsx</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> emitter <span class="keyword">from</span> <span class="string">'../util/events'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List2</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    handleClick = <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">        emitter.emit(<span class="string">'changeMessage'</span>, message);</span><br><span class="line">    &#125;;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>, <span class="string">'List2'</span>)&#125;&gt;点击我改变List1组件中显示信息&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>App.jsx</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> List1 <span class="keyword">from</span> <span class="string">'./components/List1'</span>;</span><br><span class="line"><span class="keyword">import</span> List2 <span class="keyword">from</span> <span class="string">'./components/List2'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;List1 /&gt;</span><br><span class="line">                &lt;List2 /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>自定义事件是典型的发布订阅模式,通过向事件对象上添加监听器和触发事件来实现组件之间的通信</p>
<h1 id="8-React组件的生命周期"><a href="#8-React组件的生命周期" class="headerlink" title="8. React组件的生命周期"></a>8. React组件的生命周期</h1><h2 id="8-1-生命周期钩子函数介绍"><a href="#8-1-生命周期钩子函数介绍" class="headerlink" title="8.1 生命周期钩子函数介绍"></a>8.1 生命周期钩子函数介绍</h2><ul>
<li><p>生命周期的概念：每个组件的实例，从创建、运行、到销毁，在这个过程中会出发一些列事件，这些事件就叫做组件的生命周期函数；</p>
</li>
<li><p>React组件生命周期(React 16.4+)分为三部分：</p>
<ul>
<li><strong>组件创建阶段</strong>：</li>
</ul>
<blockquote>
<p>static 开头的     只会执行一次</p>
<p>constructor    构造器     只会执行一次</p>
<p>getDerivedStateFromProps: 每次re-rendering之前被调用，作用：将传递的props映射到state里面       会执行多次</p>
<p>render           构建虚拟dom，但是此时虚拟dom还没有渲染到页面        会执行多次</p>
<p>componentDidMount:组建的虚拟dom已经挂载到页面                      只会执行一次</p>
</blockquote>
<ul>
<li><strong>组件运行阶段</strong>：根据 props 属性 或 state 状态的改变，有选择性的执行0到多次</li>
</ul>
<blockquote>
<p>getDerivedStateFromProps:每次re-rendering之前被调用</p>
<p>shouldComponentUpdate:组件是否需要被更新，返回值是true或者false。此时可以获取最新的props和state数据</p>
<p>render: 重新更新渲染组件的虚拟dom</p>
<p>getSnapshotBeforeUpdate：在最近一次渲染提交到 DOM 节点之前调用。它的含义是在React更新Dom元素之前，获取一个快照，它返回的结果将作为componentDidUpdate的第三个参数。一般的用法就是获取更新前的DOM。</p>
<p>componentDidUpdate: 组件完成了更新，此时页面已经是最新的了</p>
</blockquote>
<ul>
<li><strong>组件卸载阶段</strong>：只执行一次</li>
</ul>
<blockquote>
<p>componentWillUnmount: 当组件从 DOM 中移除时会调用如下方法，此时组件还可以被使用</p>
<p><img src="/" class="lazyload" data-src="/2019/09/27/React/1574654437154.png"  alt="1574654437154"></p>
</blockquote>
</li>
</ul>
<p>React生命周期的回调函数总结成表格如下：<br><img src="/" class="lazyload" data-src="/2019/09/27/React/1574666830021.png"  alt="1574666830021"></p>
<h2 id="8-2-defaultProps及类型校验"><a href="#8-2-defaultProps及类型校验" class="headerlink" title="8.2 defaultProps及类型校验"></a>8.2 defaultProps及类型校验</h2><h3 id="8-2-1-prop-types"><a href="#8-2-1-prop-types" class="headerlink" title="8.2.1 prop-types"></a>8.2.1 prop-types</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line">MyComponent.propTypes = &#123;</span><br><span class="line">  <span class="comment">// 你可以声明一个 prop 是一个特定的 JS 原始类型。 默认情况下，这些都是可选的。</span></span><br><span class="line">  optionalArray: PropTypes.array,</span><br><span class="line">  optionalBool: PropTypes.bool,</span><br><span class="line">  optionalFunc: PropTypes.func,</span><br><span class="line">  optionalNumber: PropTypes.number,</span><br><span class="line">  optionalObject: PropTypes.object,</span><br><span class="line">  optionalString: PropTypes.string,</span><br><span class="line">  optionalSymbol: PropTypes.symbol,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 任何东西都可以被渲染:numbers, strings, elements,数组或者是包含这些类型的片段。</span></span><br><span class="line">  optionalNode: PropTypes.node,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个 React 元素  例如 &lt;MyComponent /&gt;</span></span><br><span class="line">  optionalElement: PropTypes.element,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 你也可以声明一个 prop 是类的一个实例。 </span></span><br><span class="line">  <span class="comment">// 使用 JS 的 instanceof 运算符。</span></span><br><span class="line">  optionalMessage: PropTypes.instanceOf(Message),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 你可以声明 prop 是特定的值，类似于枚举</span></span><br><span class="line">  optionalEnum: PropTypes.oneOf([<span class="string">'News'</span>, <span class="string">'Photos'</span>]),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个对象可以是多种类型其中之一</span></span><br><span class="line">  optionalUnion: PropTypes.oneOfType([</span><br><span class="line">    PropTypes.string,</span><br><span class="line">    PropTypes.number,</span><br><span class="line">    PropTypes.instanceOf(Message)</span><br><span class="line">  ]),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个某种类型的数组</span></span><br><span class="line">  optionalArrayOf: PropTypes.arrayOf(PropTypes.number),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 属性值为某种类型的对象</span></span><br><span class="line">  optionalObjectOf: PropTypes.objectOf(PropTypes.number),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个特定形式的对象</span></span><br><span class="line">  optionalObjectWithShape: PropTypes.shape(&#123;</span><br><span class="line">    color: PropTypes.string,</span><br><span class="line">    fontSize: PropTypes.number</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 你可以使用 `isRequired' 链接上述任何一个，以确保在没有提供 prop 的情况下显示警告。</span></span><br><span class="line">  requiredFunc: PropTypes.func.isRequired,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 任何数据类型的值</span></span><br><span class="line">  requiredAny: PropTypes.any.isRequired,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-2-defaultProps"><a href="#8-2-2-defaultProps" class="headerlink" title="8.2.2 defaultProps"></a>8.2.2 defaultProps</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">//  组件创建的时候，会先执行static开头的属性和方法</span></span><br><span class="line">    <span class="comment">//  静态属性：设置props的初始值(在使用当前组件的时候，没有给当前组件传递props的时候，该初始值会生效)</span></span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">        initcount: <span class="number">1000</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        <span class="comment">// 使用 prop-types 包 来定义 initcount 为 number 类型</span></span><br><span class="line">        <span class="comment">// isRequired 表示这个props属性是必须要传递的</span></span><br><span class="line">        initcount: ReactTypes.number.isRequired</span><br><span class="line">    &#125;</span><br><span class="line">    ........</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-3-生命周期函数详解"><a href="#8-3-生命周期函数详解" class="headerlink" title="8.3 生命周期函数详解"></a>8.3 生命周期函数详解</h2><blockquote>
<p>在组件创建之前，会先初始化默认的props属性，这是全局调用一次，严格地来说，这不是组件的生命周期的一部分。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">#1.Counter.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactTypes <span class="keyword">from</span> <span class="string">'prop-types'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">//-------------------------------组件创建阶段----------------------------------------</span></span><br><span class="line">    <span class="comment">//1.在组件的创建阶段：第一个执行的是static开头的属性</span></span><br><span class="line">    <span class="comment">//设定props的默认值：当父组件没有给子组件传递props的时候就会使用这个默认值</span></span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">        initCount: <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//约定props的类型</span></span><br><span class="line">    <span class="comment">//PropTypes.number 表示是一个数值类型</span></span><br><span class="line">    <span class="comment">//isRequired 表示必须要有一个初始值</span></span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        initCount: PropTypes.number.isRequired</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.在组件创建阶段，第二个执行的是构造函数 (创建一个组件对象执行一次)</span></span><br><span class="line">    <span class="comment">//构造函数的作用：主要就是用来创建组件对象</span></span><br><span class="line">    <span class="comment">//我们可以在构造函数中声明当前组件的state</span></span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"constructor方法执行了"</span>)</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            msg: <span class="string">"张三"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构造函数中只可以给state赋予初始值，不能够通过setState()来修改state的值</span></span><br><span class="line">        <span class="comment">// this.setState(&#123;</span></span><br><span class="line">        <span class="comment">//     msg:"李四"</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.在组件的创建阶段，第三个执行的是getDerivedStateFromProps</span></span><br><span class="line">    <span class="comment">//这个方法的作用：就是将props映射到state中</span></span><br><span class="line">    <span class="comment">//在每一次re-render的时候执行</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    static getDerivedStateFromProps(nextProps, prevState)&#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.在组件的创建阶段，第四个执行的是render()方法。(在一个组件的各种生命周期阶段中，至少执行一次)</span></span><br><span class="line">    <span class="comment">//render()方法的主要作用：在内存中构建虚拟dom(此时虚拟dom还没有被挂载到页面)</span></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line"><span class="xml">                // 在render()函数中不能通过setState()来修改state状态，因为这样会陷入死循环</span></span><br><span class="line"><span class="xml">                // 其实render()函数应该是一个纯函数，这个函数的作用本身就是给他什么数据，他就显示什么数据</span></span><br><span class="line"></span><br><span class="line"><span class="xml">                // this.setState(&#123;</span></span><br><span class="line"><span class="xml">                //     msg:"李四"</span></span><br><span class="line"><span class="xml">                // &#125;)</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">            &#123;console.log("render方法执行了")&#125;</span></span><br><span class="line"><span class="xml">            这是counter组件 &#123;this.state.msg&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前数量:&#123;this.props.initCount&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.在组件的创建阶段，第五个执行的是componentDidMount。(创建一个组件对象执行一次)</span></span><br><span class="line">    <span class="comment">//componentDidMount执行的时候就表示内存中的虚拟dom已经挂载到页面了，此时页面是最新的</span></span><br><span class="line">    <span class="comment">//只有componentDidMount()钩子函数才可以通过setState()来修改state</span></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="comment">//componentDidMount()方法允许我们通过setState()来修改状态</span></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            msg: <span class="string">"李四"</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"componentDidMount方法执行了"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-------------------------------组价的运行阶段-------------------------------</span></span><br><span class="line">    <span class="comment">//当前组件的状态发生改变之后，会进入组件的运行阶段</span></span><br><span class="line">    <span class="comment">//1.在组件运行阶段，第一个执行的函数是getDerivedStateFromProps</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    static getDerivedStateFromProps(nextProps, prevState)&#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.在组件的运行阶段，第二个执行的函数是shouldComponentUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">    <span class="comment">//作用：让程序员手动控制是否要更新组件</span></span><br><span class="line">    <span class="comment">//如果这个方法返回false，就不会更新组件(后续的生命周期函数就不会执行了)；如果这个方法返回true，就会更新组件(后续的生命周期会执行)</span></span><br><span class="line">    shouldComponentUpdate(nextProps, nextState) &#123;</span><br><span class="line">        <span class="comment">// shouldComponentUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">        <span class="comment">// this.setState(&#123;</span></span><br><span class="line">        <span class="comment">//     msg:"王五"</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"shouldComponentUpdate"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.在组件的运行阶段，第三个执行的函数是render()函数</span></span><br><span class="line">    <span class="comment">//render()函数的作用：在内存中构建虚拟dom(此时虚拟dom还没有被挂载到页面)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.在组件的运行阶段，第四个执行的函数是getSnapshotBeforeUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">    <span class="comment">//主要作用：获取更新页面之前的dom信息</span></span><br><span class="line">    <span class="comment">//这个方法的返回值会作为componentDidUpdate()方法第三个参数入参</span></span><br><span class="line">    <span class="comment">//https://react.docschina.org/docs/react-component.html</span></span><br><span class="line">    getSnapshotBeforeUpdate() &#123;</span><br><span class="line">        <span class="comment">// getSnapshotBeforeUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">        <span class="comment">// this.setState(&#123;</span></span><br><span class="line">        <span class="comment">//     msg:"王五"</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"getSnapshotBeforeUpdate"</span>)</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">aa</span>: <span class="number">123</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.在组件的运行阶段，第五个执行的函数是componentDidUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">    <span class="comment">//主要作用：虚拟dom已经挂载到页面，此时页面是最新的</span></span><br><span class="line">    componentDidUpdate(prevProps, prevState, snapshot) &#123;</span><br><span class="line">        <span class="comment">// componentDidUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">        <span class="comment">// this.setState(&#123;</span></span><br><span class="line">        <span class="comment">//     msg: "王五"</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"componentDidUpdate"</span>, snapshot)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------组件的卸载阶段-----------------------------</span></span><br><span class="line">    <span class="comment">//可以在componentWillUnmount()方法中进行一些资源的释放工作。比如关闭定时器、移除事件监听。(卸载一个组件执行一次)</span></span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"componentWillUnmount"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#App.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">'@/components/counter'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            count:<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleClick = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prev</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                count:++prev.count</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            这是App组件</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Counter</span> <span class="attr">initCount</span>=<span class="string">&#123;this.state.count&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Counter</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Counter</span>&gt;</span><span class="tag">&lt;/<span class="name">Counter</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>改变count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-4-组件的重新渲染和优化"><a href="#8-4-组件的重新渲染和优化" class="headerlink" title="8.4 组件的重新渲染和优化"></a>8.4 组件的重新渲染和优化</h2><p>组件的重新渲染的执行时机：</p>
<blockquote>
<p>1.组件重新被创建</p>
<p>2.当前组件的state发生变化</p>
<p>3.父组件的state发生变化</p>
</blockquote>
<p>也就是说父组件和当前组件的state发生任何变化，都会引起组件的re-render，进而触发一系列的生命周期钩子(getDerivedStateFromProps\shouldComponentUpdate\render\getSnapshotBeforeUpdate\componentDidMount\componentDidUpdate)。</p>
<p>当我们在父组件修改了与子组件无关的state，发现子组件也会re-render，这个时候就需要借助shouldComponentUpdate钩子函数来做优化。</p>
<h3 id="8-4-1-shouldComponentUpdate优化"><a href="#8-4-1-shouldComponentUpdate优化" class="headerlink" title="8.4.1 shouldComponentUpdate优化"></a>8.4.1 shouldComponentUpdate优化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//作用：让程序员手动控制是否要更新组件</span></span><br><span class="line"><span class="comment">//如果这个方法返回false，就不会更新组件(后续的生命周期函数就不会执行了)；如果这个方法返回true，就会更新组件(后续的生命周期会执行)</span></span><br><span class="line">shouldComponentUpdate(nextProps, nextState) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"shouldComponentUpdate"</span>,nextProps,<span class="keyword">this</span>.props)</span><br><span class="line">    <span class="comment">//如果下次传递过来的initCount和当前组件props中所保持的initCount一致的时候，此时就没有必要做组件re-render</span></span><br><span class="line">    <span class="keyword">if</span>(nextProps.initCount == <span class="keyword">this</span>.props.initCount)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-4-2-PureComponent优化"><a href="#8-4-2-PureComponent优化" class="headerlink" title="8.4.2 PureComponent优化"></a>8.4.2 PureComponent优化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方式二：使用PureComponent类 </span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListOfWords</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;console.log("render")&#125;</span></span><br><span class="line"><span class="xml">            &#123;this.props.words.join(',')&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ListOfWords</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//App.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ListOfWords <span class="keyword">from</span> <span class="string">'@/components/listOfWords'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            words: [<span class="string">'marklar'</span>]</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> words = <span class="keyword">this</span>.state.words;</span><br><span class="line">        words.push(<span class="string">"marklar"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//因为PureComponent对于引用类型而言，比较的是内存地址是否一致</span></span><br><span class="line">        <span class="comment">//所以我们修改state的时候，需要给words赋值一个新的数组，此时新数组和原来数组的内存地址肯定不一致，从而组件才可能更新</span></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            words:[...words] </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            这是App2组件</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ListOfWords</span> <span class="attr">words</span>=<span class="string">&#123;this.state.words&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">ListOfWords</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>添加words<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.继承PureComponent时，不能再重写shouldComponentUpdate</span></span><br><span class="line"><span class="comment">2.继承PureComponent时，进行的是浅比较，也就是说，如果是引用类型的数据，只会比较是不是同一个地址，而不会比较具体这个地址存的数据是否完全一致</span></span><br><span class="line"><span class="comment">3.上面代码中，无论你怎么点击按钮，ListOfWords渲染的结果始终没变化，原因就是WordAdder的word的引用地址始终是同一个。</span></span><br><span class="line"><span class="comment">4.我们可以这样修改state，此时页面会发生变化，因为给words赋值了一个新对象</span></span><br><span class="line"><span class="comment">   this.setState(&#123;words:[...words]&#125;);</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="8-5-getDerivedStateFromProps存在的问题"><a href="#8-5-getDerivedStateFromProps存在的问题" class="headerlink" title="8.5 getDerivedStateFromProps存在的问题"></a>8.5 getDerivedStateFromProps存在的问题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getDerivedStateFromProps 函数会在每次re-rendering之前被调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//为什么要用getDerivedStateFromProps？答案：组件接收的props数据是只读的，我们可以使用该方法将传递的props映射到state里面，实现修改(会有诸多问题)</span></span><br><span class="line"><span class="comment">//注意点：该方法是一个静态方法，方法中没有this，故而不可以直接通过this.setState()来改变状态，而是需要通过return来改变状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数：</span></span><br><span class="line"><span class="comment">//1.nextProps外部传递过来的props属性</span></span><br><span class="line"><span class="comment">//2.prevState之前的state状态</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> getDerivedStateFromProps(nextProps, prevState) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"getDerivedStateFromProps"</span>, nextProps, prevState)</span><br><span class="line">    <span class="comment">//获取到父组件中传递过来的initcount值</span></span><br><span class="line">    <span class="keyword">const</span> &#123; initcount &#125; = nextProps;</span><br><span class="line">    <span class="comment">//当父组件中传递过来的initcount发生改变了</span></span><br><span class="line">    <span class="keyword">if</span> (initcount != prevState.prevCount) &#123;</span><br><span class="line">        <span class="comment">//在方法中返回&#123;count:initcount&#125; 替换掉当前state中的 count值</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            count: initcount,</span><br><span class="line">            prevCount:initcount</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果props传入的内容不需要影响到你的state，那么就需要返回一个null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//问题：</span></span><br><span class="line"><span class="number">1.</span>当前组件的状态由多个源控制，父组件中控制列表数据，子组件中又控制了type这个state。</span><br><span class="line">因此父组件state改掉之后，会触发子组件重新渲染；本身组件state改掉之后，会触发当前组件重新渲染</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>如果你的组件内部既需要修改自己的type，又需要接收从外部修改的type。逻辑非常混乱！getDerivedStateFromProps中你根本不知道该做什么。</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (initcount != prevState.prevCount) &#123;</span><br><span class="line">    <span class="comment">//在方法中返回&#123;count:initcount&#125; 替换掉当前state中的 count值</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        count: initcount,</span><br><span class="line">        prevCount:initcount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果彻底解决这个问题呢？</span><br><span class="line">答案：好好组织你的组件，在非必须的时候，摒弃这种写法(派生属性)。type要么由props驱动，要么完全由state驱动。</span><br><span class="line"></span><br><span class="line">从这个生命周期的更新来看，react更希望将受控的props和state进行分离，就如同Redux作者Dan Abramov在redux文档当中写的一样Presentational and Container Components，将所有的组件分离称为展示型组件和容器型组件，一个只负责接收props来改变自己的样式，一个负责保持其整个模块的state。这样可以让代码更加清晰。但是在实际的业务逻辑中，我们有时很难做到这一点，而且这样可能会导致容器型组件变得非常庞大以致难以管理，如何进行取舍还是需要根据实际场景决定的</span><br></pre></td></tr></table></figure>

<h2 id="8-6-React老版本生命周期"><a href="#8-6-React老版本生命周期" class="headerlink" title="8.6 React老版本生命周期"></a>8.6 React老版本生命周期</h2><p><img src="/" class="lazyload" data-src="/2019/09/27/React/3284159097-5bbb08d17db33_articlex-1584956954768.png"  alt="3284159097-5bbb08d17db33_articlex"></p>
<h1 id="9-React-router"><a href="#9-React-router" class="headerlink" title="9. React-router"></a>9. React-router</h1><h2 id="9-1-前端路由的两种实现方案"><a href="#9-1-前端路由的两种实现方案" class="headerlink" title="9.1 前端路由的两种实现方案"></a>9.1 前端路由的两种实现方案</h2><ol>
<li><p>hash : hash原本的作用是为一个很长的文档页添加锚点信息，它自带不改变url刷新页面的功能，所以自然而然被用单页面应用程序中了。</p>
</li>
<li><p>history : 应该说history是主流的解决方案，浏览器的前进后退用的就是这个，它是window对象下的，以前的history提供的方法只能做页面之间的前进后退，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">history.go(number|URL) 可加载历史列表中的某个具体的页面</span><br><span class="line">history.forward() 可加载历史列表中的下一个 URL</span><br><span class="line">history.back() 可加载历史列表中的前一个 URL</span><br></pre></td></tr></table></figure>

<p>为了在不刷新浏览器的情况下，创建新的浏览记录并插入浏览记录队列中，html5新增了如下方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. history.pushState(state, title, url)</span><br><span class="line">   添加一条历史记录， state用于传递参数，可以为空。title是设置历史记录的标题，可以为空。url是历史记录的URL，不可以为空。</span><br><span class="line"></span><br><span class="line">2.history.replaceState(state, title, url)</span><br><span class="line">将history堆栈中当前的记录替换成这里的url，参数同上。</span><br><span class="line"></span><br><span class="line">这个特性后来用到了单页面应用中比如：vue-router，react-router-dom里面。</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="9-2-Reac中的路由"><a href="#9-2-Reac中的路由" class="headerlink" title="9.2 Reac中的路由"></a>9.2 Reac中的路由</h2><p><code>&lt;Router&gt;</code>是React中实现路由最外层的容器，一般情况下我们不再需要直接使用它，而是使用在它基础之上封装的几个适用于不同环境的组件，react-router-dom的Router有四种：</p>
<table>
<thead>
<tr>
<th>Router</th>
<th>适用情况</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://link.jianshu.com?t=https%3A%2F%2Freacttraining.com%2Freact-router%2Fweb%2Fapi%2FBrowserRouter" target="_blank" rel="noopener">BrowserRouter</a></td>
<td>react-router-dom扩展，利用HTML5 新增的history API (pushState, replaceState)，是web应用最常用的路由组件</td>
</tr>
<tr>
<td><a href="https://link.jianshu.com?t=https%3A%2F%2Freacttraining.com%2Freact-router%2Fweb%2Fapi%2FHashRouter" target="_blank" rel="noopener">HashRouter</a></td>
<td>react-router-dom扩展，利用window.location.hash，适用于低版本浏览器或者一些特殊情境</td>
</tr>
<tr>
<td><a href="https://link.jianshu.com?t=https%3A%2F%2Freacttraining.com%2Freact-router%2Fweb%2Fapi%2FMemoryRouter" target="_blank" rel="noopener">MemoryRouter</a></td>
<td>继承自react-router ，用户在地址栏看不到任何路径变化，一般用在测试或者非浏览器环境开发中</td>
</tr>
<tr>
<td><a href="https://link.jianshu.com?t=https%3A%2F%2Freacttraining.com%2Freact-router%2Fweb%2Fapi%2FStaticRouter" target="_blank" rel="noopener">StaticRouter</a></td>
<td>继承自react-router，某些页面从渲染出来以后没有多的交互，所以没有状态的变化需要存储，就可以使用静态路由，静态路由适用于服务器端</td>
</tr>
</tbody></table>
<p>一般我们很少会用到MemoryRouter和StaticRouter，在web应用中更多的是用   <code>react-router-dom</code>扩展出来的BrowserRouter和HashRouter，这两个就是我前面提到的前端路由的两种解决办法的各自实现。</p>
<h2 id="9-3-HashRouter的基本使用"><a href="#9-3-HashRouter的基本使用" class="headerlink" title="9.3 HashRouter的基本使用"></a>9.3 HashRouter的基本使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom -S</span><br><span class="line"></span><br><span class="line">#1.main.js </span><br><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.jsx'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 render 函数渲染 虚拟DOM</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span>&gt;</span><span class="tag">&lt;/<span class="name">App</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">#2.App.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HashRouter 表示一个路由的跟容器，所有的路由相关的东西，都要包裹在 HashRouter 里面</span></span><br><span class="line"><span class="comment">// Route 表示一个路由规则， 在 Route 上有两个比较重要的属性：path   component</span></span><br><span class="line"><span class="comment">// Link 表示一个路由的链接 ，就好比 vue 中的 &lt;router-link to=""&gt;&lt;/router-link&gt;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./components/Home.jsx'</span></span><br><span class="line"><span class="keyword">import</span> Movie <span class="keyword">from</span> <span class="string">'./components/Movie.jsx'</span></span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">'./components/About.jsx'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// 当 使用 HashRouter 把 App 根组件的元素包裹起来之后，网站就已经启用路由了</span></span><br><span class="line">    <span class="comment">// 在一个 HashRouter 中，只能有唯一的一个根元素</span></span><br><span class="line">    <span class="comment">// 在一个网站中，只需要使用 唯一的一次 &lt;HashRouter&gt;&lt;/HashRouter&gt; 就行了</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;这是网站的APP根组件&lt;/h1&gt;</span><br><span class="line">      </span><br><span class="line">        &lt;Link to="/home"&gt;首页&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">        &lt;Link to="/movie/top250/10"&gt;电影&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">        &lt;Link to="/about"&gt;关于&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">        &#123;/* Route 创建的标签，就是路由规则，其中 path 表示要匹配的路由，component 表示要展示的组件 */&#125;</span><br><span class="line">        &#123;/* 在 vue 中有个 router-view 的路由标签专门用来放置匹配到的路由组件的，但是在 react-router 中并没有类似于这样的标签，而是直接把 Route 标签当作的坑（占位符） */&#125;</span><br><span class="line">        &#123;/* Route 具有两种身份：1. 它是一个路由匹配规则； 2. 它是一个占位符，表示将来匹配到的组件都放到这个位置， 如果想让路由规则进行精确匹配，可以为 Route添加 exact 属性，表示启用精确匹配模式 */&#125;</span><br><span class="line">        &lt;Route path="/home" component=&#123;Home&#125;&gt;&lt;/Route&gt;</span><br><span class="line"></span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">        &#123;/* 注意：默认情况下，路由中的规则是模糊匹配的，如果路由可以部分匹配成功，就会展示这个路由对应的组件 */&#125;</span><br><span class="line">        &#123;/* 如果要匹配参数，可以在匹配规则中使用 : 修饰符，表示这个位置匹配到的是参数 */&#125;</span><br><span class="line">        &lt;Route path="/movie/:type/:id" component=&#123;Movie&#125; exact&gt;&lt;/Route&gt;</span><br><span class="line"></span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Route path="/about" component=&#123;About&#125;&gt;&lt;/Route&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#3.components/Home.jsx    </span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      Home</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#4. components/Movie.jsx </span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// 如果想要从路由规则中，提取匹配到的参数进行使用，可以使用 this.props.match.params.*** 来访问</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      Movie --- &#123;this.props.match.params.type&#125; --- &#123;this.props.match.params.id&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#5. components/About.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">About</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      About</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-4-匹配规则"><a href="#9-4-匹配规则" class="headerlink" title="9.4 匹配规则"></a>9.4 匹配规则</h2><p><strong>默认：</strong></p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one</td>
<td>/one</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/111</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/aaa/bbb</td>
<td>是</td>
</tr>
</tbody></table>
<p><strong>exact配置：</strong>exact属性为true时路径中的hash值必须和path完全一致才渲染对应的组件，如果为false则’/‘也可以匹配’/xxx’</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>exact</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one</td>
<td>/one/two</td>
<td>true</td>
<td>否</td>
</tr>
<tr>
<td>/one</td>
<td>/one/two</td>
<td>false</td>
<td>是</td>
</tr>
</tbody></table>
<p><strong>strict配置：</strong>strict属性主要就是匹配反斜杠，规定是否匹配末尾包含反斜杠的路径，如果strict为true，则如果path中不包含反斜杠结尾，则他也不能匹配包含反斜杠结尾的路径</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>strict</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one/</td>
<td>/one</td>
<td>true</td>
<td>否</td>
</tr>
<tr>
<td>/one/</td>
<td>/one/</td>
<td>true</td>
<td>是</td>
</tr>
<tr>
<td>/one/</td>
<td>/one/two</td>
<td>true</td>
<td>是</td>
</tr>
</tbody></table>
<h2 id="9-5-Switch和Redirect"><a href="#9-5-Switch和Redirect" class="headerlink" title="9.5 Switch和Redirect"></a>9.5 Switch和Redirect</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Link, Switch,Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line">render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;HashRouter&gt;</span><br><span class="line">                &#123;<span class="comment">/*</span></span><br><span class="line"><span class="comment">                Switch表示路由互斥，如果没有Switch，会根据路由找到所有匹配的组件显示</span></span><br><span class="line"><span class="comment">                比如http://localhost:3000/#/user  会找到/、/user所匹配的路由(下面home没有找到是因为精确匹配了)</span></span><br><span class="line"><span class="comment">                */</span>&#125;</span><br><span class="line">                &lt;Switch&gt;</span><br><span class="line">                    &#123;<span class="comment">/*</span></span><br><span class="line"><span class="comment">                    path:/ 表示访问根路径的情况下默认载入home组件</span></span><br><span class="line"><span class="comment">                    exact精确匹配，为了给其他组件一个机会获取到url改变</span></span><br><span class="line"><span class="comment">                    */</span>&#125;</span><br><span class="line">                    &lt;Route path=<span class="string">'/'</span> exact  component=&#123;Home&#125;/&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">'/city'</span> component=&#123;City&#125;/&gt;</span><br><span class="line">                    &#123;<span class="comment">/*</span></span><br><span class="line"><span class="comment">                    strict 在确定路径是否与当前URL匹配时，将考虑路径后的斜线；</span></span><br><span class="line"><span class="comment">                    */</span>&#125;</span><br><span class="line">                    &lt;Route path=<span class="string">'/login/'</span> strict component=&#123;Login&#125;/&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">'/user'</span> component=&#123;User&#125;/&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">'/search/:category/'</span> strict component=&#123;Search&#125;/&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">'/detail/:id'</span> component=&#123;Detail&#125;/&gt;</span><br><span class="line">                    &#123;<span class="comment">/*没有匹配到路径的时候重定向到根路径*/</span>&#125;</span><br><span class="line">                    &lt;Redirect to=<span class="string">"/"</span> /&gt;</span><br><span class="line">                &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>HashRouter&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-6-React中的编程式导航和路由传参"><a href="#9-6-React中的编程式导航和路由传参" class="headerlink" title="9.6 React中的编程式导航和路由传参"></a>9.6 React中的编程式导航和路由传参</h2><h3 id="9-6-1-withRouter的使用"><a href="#9-6-1-withRouter的使用" class="headerlink" title="9.6.1 withRouter的使用"></a>9.6.1 withRouter的使用</h3><p>withRouter可以包装任何自定义组件，将react-router 的 history,location,match 三个对象传入。 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route exact path=<span class="string">"/Home"</span> component=&#123;Home&#125;/&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 1.只有包裹在Route组件里的才能使用<code>this.props.location</code>，<br> 2.假如有个需求，是面包屑或者导航组件里需要拿到<code>this.props.location</code>（导航组件或者面包屑一般不会包裹在<code>Route</code>里），那么直接这么写显然就不行了。<br> 这个时候<code>withRouter</code>修饰一下，就可以这么写了。</p>
</blockquote>
<h3 id="9-6-2-使用withRouter跳转页面"><a href="#9-6-2-使用withRouter跳转页面" class="headerlink" title="9.6.2 使用withRouter跳转页面"></a>9.6.2 使用withRouter跳转页面</h3><blockquote>
<p>只有在 <Route> 包裹的组件中才能在 this.props 属性中找到 history 对象。但有些情况下我们就是希望在一个没被 <Route> 包裹的组件中用到 history 对象，我们可以这样用</Route></Route></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(YourComponent)</span><br><span class="line"></span><br><span class="line"><span class="comment">//此时就可以在组件中使用this.props.history跳转路由了</span></span><br><span class="line"><span class="keyword">this</span>.props.history.push(&#123;<span class="attr">pathname</span>:<span class="string">"/path/"</span>&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="9-6-3-路由传参"><a href="#9-6-3-路由传参" class="headerlink" title="9.6.3 路由传参"></a>9.6.3 路由传参</h3><h4 id="a-params方式传参"><a href="#a-params方式传参" class="headerlink" title="a) params方式传参"></a>a) params方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/path/:name'</span> component=&#123;Path&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Link to=<span class="string">"/path/2"</span>&gt;xxx&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">this.props.history.push(&#123;pathname:"/</span>path/<span class="string">" + name&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">读取参数用:this.props.match.params.name</span></span><br></pre></td></tr></table></figure>

<p>优势 ： 刷新地址栏，参数依然存在<br>缺点  :   只能传字符串，并且如果传的值太多的话，url会变得长而丑陋。</p>
<h4 id="b-query方式传参"><a href="#b-query方式传参" class="headerlink" title="b) query方式传参"></a>b) query方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/query'</span> component=&#123;Query&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Link to=&#123;&#123; <span class="attr">pathname</span> : <span class="string">' /query'</span> , <span class="attr">query</span> : &#123; <span class="attr">name</span> : <span class="string">'sunny'</span> &#125;&#125;&#125;&gt;</span><br><span class="line"><span class="keyword">this</span>.props.history.push(&#123;<span class="attr">pathname</span>:<span class="string">"/query"</span>,<span class="attr">query</span>: &#123; <span class="attr">name</span> : <span class="string">'sunny'</span> &#125;&#125;);</span><br><span class="line"></span><br><span class="line">读取参数用: <span class="keyword">this</span>.props.location.query.name</span><br></pre></td></tr></table></figure>

<p>优势：传参优雅，传递参数可传对象；<br>缺点：刷新地址栏，参数丢失</p>
<h4 id="c-state方式传参"><a href="#c-state方式传参" class="headerlink" title="c) state方式传参"></a>c) state方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/sort '</span> component=&#123;Sort&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Link to=&#123;&#123; <span class="attr">pathname</span> : <span class="string">' /sort '</span> , <span class="attr">state</span> : &#123; <span class="attr">name</span> : <span class="string">'sunny'</span> &#125;&#125;&#125;&gt; </span><br><span class="line"><span class="keyword">this</span>.props.history.push(&#123;<span class="attr">pathname</span>:<span class="string">"/sort "</span>,<span class="attr">state</span> : &#123; <span class="attr">name</span> : <span class="string">'sunny'</span> &#125;&#125;);</span><br><span class="line"></span><br><span class="line">读取参数用: <span class="keyword">this</span>.props.location.state.name</span><br></pre></td></tr></table></figure>

<p>优势：传参优雅，传递参数可传对象，state传的参数是加密的<br>缺点：刷新地址栏，参数丢失</p>
<h4 id="d-search方式传参"><a href="#d-search方式传参" class="headerlink" title="d) search方式传参"></a>d) search方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/web/departManange '</span> component=&#123;DepartManange&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;link to=<span class="string">"web/departManange?tenantId=12121212"</span>&gt;xxx&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">this.props.history.push(&#123;pathname:"/</span>web/departManange<span class="string">",search: 'tenantId=12121212'&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">读取参数用: this.props.location.search</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//search参数的解析</span></span><br><span class="line"><span class="string">npm install --save url</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">httpUrl = this.props.location.search;</span></span><br><span class="line"><span class="string">url.parse(httpUrl, true).query.tenantId;</span></span><br></pre></td></tr></table></figure>

<p>优势 ： 刷新地址栏，参数依然存在</p>
<p>缺点  :   只能传字符串，并且如果传的值太多的话，url会变得长而丑陋。</p>
<h2 id="9-7-组件懒加载"><a href="#9-7-组件懒加载" class="headerlink" title="9.7 组件懒加载"></a>9.7 组件懒加载</h2><p><code>React.lazy</code> 函数能让你像渲染常规组件一样处理动态引入（的组件）。</p>
<p><code>React.lazy</code> 接受一个函数，这个函数需要动态调用 <code>import()</code>。它必须返回一个 <code>Promise</code>，该 Promise 需要 resolve 一个 <code>defalut</code> export 的 React 组件。</p>
<p>然后应在 <code>Suspense</code> 组件中渲染 lazy 组件(Suspense 就是实现所谓的延迟加载效果)，如此使得我们可以使用在等待加载 lazy 组件时做优雅降级（如 loading 指示器等）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;OtherComponent /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-8-基于路由的代码分割"><a href="#9-8-基于路由的代码分割" class="headerlink" title="9.8 基于路由的代码分割"></a>9.8 基于路由的代码分割</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; Suspense, lazy &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./routes/Home'</span>));</span><br><span class="line"><span class="keyword">const</span> About = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./routes/About'</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    <span class="comment">//fallback 属性接受任何在组件加载过程中你想展示的 React 元素</span></span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Route exact path="/</span><span class="string">" component=&#123;Home&#125;/&gt;</span></span><br><span class="line"><span class="string">        &lt;Route path="</span>/about<span class="string">" component=&#123;About&#125;/&gt;</span></span><br><span class="line"><span class="string">      &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">    &lt;/Suspense&gt;</span></span><br><span class="line"><span class="string">  &lt;/Router&gt;</span></span><br><span class="line"><span class="string">);</span></span><br></pre></td></tr></table></figure>

<h1 id="10-ReactTransitionGroup动画"><a href="#10-ReactTransitionGroup动画" class="headerlink" title="10.ReactTransitionGroup动画"></a>10.ReactTransitionGroup动画</h1><p><a href="https://reactcommunity.org/react-transition-group/" target="_blank" rel="noopener">https://reactcommunity.org/react-transition-group/</a></p>
<p>react-transition-group 一个官网提供的动画过度库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># npm</span><br><span class="line">npm install react-transition-group --save</span><br><span class="line"></span><br><span class="line"># yarn</span><br><span class="line">yarn add react-transition-group</span><br></pre></td></tr></table></figure>

<p>而官方提供的四个组建<code>Transition</code>，<code>CSSTransition</code>，<code>SwitchTransiton</code>，<code>TransitonGroup</code>。</p>
<h2 id="10-1-Transition"><a href="#10-1-Transition" class="headerlink" title="10.1 Transition"></a>10.1 Transition</h2><p>过渡组件(Transiton)允许您用一个简单的声明性API描述随着时间的推移从一个组件状态到另一个组件状态的转换。最常用的是用来动画一个组件的安装和卸载，但也可以用来描述在适当的过渡状态。默认情况下，该组件不会更改其呈现的组件的行为，它只跟踪组件的“进入”和“退出”的状态。由你来为这些状态定义效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Transition &#125; <span class="keyword">from</span> <span class="string">'react-transition-group'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Fade</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line">    done = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'结束了'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    addEndListener = <span class="function">(<span class="params">node</span>) =&gt;</span> &#123; <span class="comment">//原生时间transition运动的事件</span></span><br><span class="line">        node.addEventListener(<span class="string">'transitionend'</span>, <span class="keyword">this</span>.done, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 三个进入状态的事件，可以做你想做的事情</span></span><br><span class="line">    onEnter = <span class="function">(<span class="params">node, isAppearing</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(isAppearing, <span class="string">'onEnter'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    onEntering = <span class="function">(<span class="params">node, isAppearing</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(isAppearing, <span class="string">'onEntering'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    onEntered = <span class="function">(<span class="params">node, isAppearing</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(isAppearing, <span class="string">'onEntered'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 三个退出的状态的事件</span></span><br><span class="line">    onExit = <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'onExit'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    onExiting = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'onExiting'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    onExited = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'onExited'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; <span class="attr">in</span>: inProp &#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> defaultStyle = &#123;</span><br><span class="line">            transition: <span class="string">`transform <span class="subst">$&#123;<span class="number">300</span>&#125;</span>ms ease-in-out, opacity <span class="subst">$&#123;<span class="number">300</span>&#125;</span>ms ease-in-out`</span>,</span><br><span class="line">            transform: <span class="string">'translateX(100px)'</span>,</span><br><span class="line">            opacity: <span class="string">'0'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> transitionStyles = &#123;</span><br><span class="line">            entering: &#123; <span class="attr">transform</span>: <span class="string">'translateX(100px)'</span>, <span class="attr">opacity</span>: <span class="string">'0'</span> &#125;,</span><br><span class="line">            entered: &#123; <span class="attr">transform</span>: <span class="string">'translateX(0px)'</span>, <span class="attr">opacity</span>: <span class="string">'1'</span> &#125;,</span><br><span class="line">            exiting: &#123; <span class="attr">transform</span>: <span class="string">'translateX(0px)'</span>, <span class="attr">opacity</span>: <span class="string">'1'</span> &#125;,</span><br><span class="line">            exited: &#123; <span class="attr">transform</span>: <span class="string">'translateX(100px)'</span>, <span class="attr">opacity</span>: <span class="string">'0'</span> &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> duration = &#123;</span><br><span class="line">            enter: <span class="number">300</span>,</span><br><span class="line">            exit: <span class="number">300</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 上面的都是基本参数，样式的转变以及时间的设定，具体的可以看官网文档</span></span><br><span class="line">        <span class="comment">// 样式也可以写成className 例如&lt;MyComponent className=&#123;`fade fade-$&#123;status&#125;`&#125; /&gt;</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Transition</span><br><span class="line">                onEnter=&#123;<span class="keyword">this</span>.onEnter&#125;</span><br><span class="line">                onEntering=&#123;<span class="keyword">this</span>.onEntering&#125;</span><br><span class="line">                onEntered=&#123;<span class="keyword">this</span>.onEntered&#125;</span><br><span class="line"></span><br><span class="line">                onExit=&#123;<span class="keyword">this</span>.onExit&#125;</span><br><span class="line">                onExiting=&#123;<span class="keyword">this</span>.onExiting&#125;</span><br><span class="line">                onExited=&#123;<span class="keyword">this</span>.onExited&#125;</span><br><span class="line"></span><br><span class="line">                addEndListener=&#123;<span class="keyword">this</span>.addEndListener&#125;</span><br><span class="line">                <span class="keyword">in</span>=&#123;inProp&#125;</span><br><span class="line">                unmountOnExit=&#123;<span class="literal">false</span>&#125; <span class="comment">// 为true 代表退出的时候移除dom</span></span><br><span class="line">                appear=&#123;<span class="literal">true</span>&#125;     <span class="comment">// 为true 初始动画</span></span><br><span class="line">                timeout=&#123;duration&#125;</span><br><span class="line">            &gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    state =&gt; &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(state, <span class="string">'###'</span>) <span class="comment">//你可以很直观的看到组件加载和卸载时候的状态</span></span><br><span class="line">                        <span class="keyword">return</span> (</span><br><span class="line">                            &lt;div style=&#123;&#123;</span><br><span class="line">                                ...defaultStyle,</span><br><span class="line">                                ...transitionStyles[state]</span><br><span class="line">                            &#125;&#125;&gt;</span><br><span class="line">                                &#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">                            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                        )</span></span><br><span class="line"><span class="regexp">                    &#125;</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Transition&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Fade <span class="keyword">from</span> <span class="string">'./Fade.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Dnd</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        flag:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    handle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prev</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                flag: !prev.flag</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;() =&gt; <span class="keyword">this</span>.handle()&#125;&gt;点击transition&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Fade in=&#123;this.state.flag&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;div&gt;动画&lt;/</span>div&gt;</span><br><span class="line">                &lt;<span class="regexp">/Fade&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-2-CSSTransition"><a href="#10-2-CSSTransition" class="headerlink" title="10.2 CSSTransition"></a>10.2 CSSTransition</h2><p>此组件是在转换的出现、进入、退出阶段应用一对类名(也就是className)，靠这个来激活CSS动画。所以参数和平时的className不同，参数为：<code>classNames</code><br>参数：（主要）in, timeout, unmountOnExit, classNames, 用法同Transition。看如下例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./star.css'</span></span><br><span class="line"><span class="keyword">import</span> &#123; CSSTransition &#125; <span class="keyword">from</span> <span class="string">'react-transition-group'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Star</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        star: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleStar = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prev</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                star:!prev.star</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;this.handleStar()&#125;&#125;&gt;start<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">            &lt;CSSTransition</span><br><span class="line">                in=&#123;this.state.star&#125;</span><br><span class="line">                timeout=&#123;300&#125;</span><br><span class="line">                classNames="star"</span><br><span class="line">                unmountOnExit  //为true 代表退出的时候移除dom</span><br><span class="line">            &gt;</span><br><span class="line">                &#123;/*指定默认样式*/&#125;   </span><br><span class="line">                &lt;div className="star"&gt;星星&lt;/div&gt;</span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.star &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    margin-left: <span class="number">0.5</span>rem;</span><br><span class="line">    transform: scale(<span class="number">1.25</span>);</span><br><span class="line">&#125;</span><br><span class="line">.star-enter &#123;</span><br><span class="line">    opacity: <span class="number">0.01</span>;</span><br><span class="line">    transform: translateY(<span class="number">-100</span>%) scale(<span class="number">0.75</span>);</span><br><span class="line">&#125;</span><br><span class="line">.star-enter-active &#123;</span><br><span class="line">    opacity: <span class="number">1</span>;</span><br><span class="line">    transform: translateY(<span class="number">0</span>%) scale(<span class="number">1.25</span>);</span><br><span class="line">    transition: all <span class="number">300</span>ms ease-out;</span><br><span class="line">&#125;</span><br><span class="line">.star-exit &#123;</span><br><span class="line">    opacity: <span class="number">1</span>;</span><br><span class="line">    transform: scale(<span class="number">1.25</span>);</span><br><span class="line">&#125;</span><br><span class="line">.star-exit-active &#123;</span><br><span class="line">    opacity: <span class="number">0</span>;</span><br><span class="line">    transform: scale(<span class="number">4</span>);</span><br><span class="line">    transition: all <span class="number">300</span>ms ease-<span class="keyword">in</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-3-SwitchTransition"><a href="#10-3-SwitchTransition" class="headerlink" title="10.3 SwitchTransition"></a>10.3 SwitchTransition</h2><p>受vue过渡模式启发的过渡组件， 当您要控制状态转换之间的渲染时，可以使用它。SwitchTransition不提供任何形式的动画，具体的动画取决与你包裹的Transition || CSSTransition的动画。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; SwitchTransition, CSSTransition &#125; <span class="keyword">from</span> <span class="string">'react-transition-group'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./switch.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SwitchAnim</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            flag: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    toggle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="function">(<span class="params">prev</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                flag: !prev.flag</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.toggle&#125;</span>&gt;</span>点我切换组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">            &lt;SwitchTransition&gt;</span><br><span class="line">                &lt;CSSTransition</span><br><span class="line">                    key=&#123;this.state.flag ? "A" : "B"&#125;</span><br><span class="line">                    classNames="fade"</span><br><span class="line">                    timeout=&#123;300&#125;&gt;</span><br><span class="line">                    &#123;this.state.flag ? &lt;div&gt;AAAA&lt;/div&gt; : &lt;div&gt;BBBB&lt;/div&gt;&#125;</span><br><span class="line">                &lt;/CSSTransition&gt;</span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">SwitchTransition</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.fade-enter &#123;</span><br><span class="line">    opacity: <span class="number">0.01</span>;  </span><br><span class="line">&#125;</span><br><span class="line">.fade-enter-active &#123;</span><br><span class="line">    opacity: <span class="number">1</span>;</span><br><span class="line">    transition: opacity <span class="number">500</span>ms ease-<span class="keyword">in</span>;</span><br><span class="line">&#125;</span><br><span class="line">.fade-exit &#123;</span><br><span class="line">    opacity: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">.fade-exit-active &#123;</span><br><span class="line">    opacity: <span class="number">0.01</span>;</span><br><span class="line">    transition: opacity <span class="number">500</span>ms ease-<span class="keyword">in</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-4-TransitionGroup"><a href="#10-4-TransitionGroup" class="headerlink" title="10.4 TransitionGroup"></a>10.4 TransitionGroup</h2><p>一看group就知道肯定是列表形态的动画了！但是看了官网后知道，TransitionGroup不提供任何形式的动画，具体的动画取决与你包裹的Transition || CSSTransition的动画，所以你可以在列表里面做出不同类型的动画出来。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; TransitionGroup, CSSTransition &#125; <span class="keyword">from</span> <span class="string">'react-transition-group'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./switch.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ListAnim</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            items: [</span><br><span class="line">                &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">'Buy eggs'</span> &#125;,  <span class="comment">//0</span></span><br><span class="line">                &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">'Pay bills'</span> &#125;,  <span class="comment">//1</span></span><br><span class="line">                &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">text</span>: <span class="string">'Invite friends over'</span> &#125;, <span class="comment">//2</span></span><br><span class="line">                &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">text</span>: <span class="string">'Fix the TV'</span> &#125;,  <span class="comment">//3</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleAdd = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> items = <span class="keyword">this</span>.state.items;</span><br><span class="line">        items.unshift(&#123; <span class="attr">id</span>: items.length + <span class="number">1</span>, <span class="attr">text</span>: <span class="string">"张三"</span> &#125;);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            items: [...items]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleRemove = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prev</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                items: prev.items.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.id != id)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> items = <span class="keyword">this</span>.state.items;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &lt;TransitionGroup&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    items.map(item =&gt; (</span><br><span class="line">                        &lt;CSSTransition</span><br><span class="line">                            key=&#123;item.id&#125;  //这边的key一定要能唯一标识当前元素</span><br><span class="line">                            timeout=&#123;300&#125;</span><br><span class="line">                            classNames="fade"</span><br><span class="line">                        &gt;</span><br><span class="line">                            &lt;div style=&#123;&#123; background: "red" &#125;&#125;&gt;</span><br><span class="line">                                &#123;item.text&#125;</span><br><span class="line">                                &lt;button onClick=&#123;() =&gt; this.handleRemove(item.id)&#125;&gt;&amp;times;&lt;/button&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/CSSTransition&gt;</span><br><span class="line">                    ))</span><br><span class="line">                &#125;</span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">TransitionGroup</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleAdd&#125;</span>&gt;</span>添加元素<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.fade-enter &#123;</span><br><span class="line">    opacity: <span class="number">0.01</span>;  </span><br><span class="line">&#125;</span><br><span class="line">.fade-enter-active &#123;</span><br><span class="line">    opacity: <span class="number">1</span>;</span><br><span class="line">    transition: opacity <span class="number">500</span>ms ease-<span class="keyword">in</span>;</span><br><span class="line">&#125;</span><br><span class="line">.fade-exit &#123;</span><br><span class="line">    opacity: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">.fade-exit-active &#123;</span><br><span class="line">    opacity: <span class="number">0.01</span>;</span><br><span class="line">    transition: opacity <span class="number">500</span>ms ease-<span class="keyword">in</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="11-高阶组件"><a href="#11-高阶组件" class="headerlink" title="11.高阶组件"></a>11.高阶组件</h1><h2 id="11-1-高阶函数"><a href="#11-1-高阶函数" class="headerlink" title="11.1 高阶函数"></a>11.1 高阶函数</h2><p><strong>高阶函数是一个函数，它接收函数作为参数或将函数作为输出返回</strong></p>
<ul>
<li><p>举个栗子:</p>
<ul>
<li><p>接收函数作为参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function a(x) &#123;</span><br><span class="line">  x();</span><br><span class="line">&#125;</span><br><span class="line">function b() &#123;</span><br><span class="line">  alert(&#39;hello&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a(b);</span><br></pre></td></tr></table></figure>
</li>
<li><p>将函数作为输出返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function a() &#123;</span><br><span class="line">  function b() &#123;</span><br><span class="line">    alert(&#39;hello&#39;);</span><br><span class="line">  &#125;</span><br><span class="line">  return b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a()();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>以上函数a就是一个高阶函数, 用法非常简单, 那么实际开发中又有哪些是高阶函数呢？</p>
<ul>
<li>Array 的 map 、reduce 、filter 等方法</li>
<li>Object 的 keys 、values 等方法</li>
</ul>
</li>
</ul>
<h2 id="11-2-高阶组件"><a href="#11-2-高阶组件" class="headerlink" title="11.2 高阶组件"></a>11.2 高阶组件</h2><ul>
<li><p>概念：<strong>高阶组件就是一个函数，且该函数接受一个组件作为参数，并返回一个新的组件</strong></p>
</li>
<li><p>举个栗子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">   render()&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello React<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">            </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span>/&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NewComponent = HocComponent(MyComponent)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;NewComponent&gt;&lt;<span class="regexp">/NewComponent&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>HocComponent函数就是一个高阶组件。</p>
</li>
</ul>
<blockquote>
<p>高阶组件可以看做是装饰器模式(Decorator Pattern)在React的实现。即允许向一个现有的对象添加新的功能，同时又不改变其结构，属于包装模式(Wrapper Pattern)的一种。最大的特点就是重用组件逻辑</p>
</blockquote>
<h3 id="11-2-1-高阶组件的实现方式-属性代理"><a href="#11-2-1-高阶组件的实现方式-属性代理" class="headerlink" title="11.2.1 高阶组件的实现方式-属性代理"></a>11.2.1 高阶组件的实现方式-属性代理</h3><p>属性代理(Props Proxy)：<code>HOC</code>是包裹在普通组件外面的一层高阶函数，任何要传入普通组件内的<code>props</code> 或者 <code>state</code> 首先都要经过 <code>HOC</code>。</p>
<p><code>props</code>和 <code>state</code>等属性原本是要流向 目标组件的腰包的，但是却被 雁过拔毛的<code>HOC</code>拦路打劫，那么最终这些 <code>props</code>和 <code>states</code>数据到底还能不能再到达 目标组件，或者哪些能到达以及到达多少就全由 <code>HOC</code>说了算了，也就是说，<code>HOC</code>拥有了提前对这些属性进行修改的能力。</p>
<p>属性代理的作用：</p>
<ul>
<li>更改prop</li>
<li>通过refs获取组件实例</li>
<li>抽象state</li>
<li>把WrappedComponent与其他elements包装在一起</li>
</ul>
<h4 id="a-属性代理-更改props"><a href="#a-属性代理-更改props" class="headerlink" title="a) 属性代理-更改props"></a>a) 属性代理-更改props</h4><p>在高阶组件中添加新的 props，可以在 WrappedComponent 中通过 this.props.name访问到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  render()&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello React &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125;/&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NewComponent = HocComponent(MyComponent)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;NewComponent name=<span class="string">"zhangsan"</span>&gt;&lt;<span class="regexp">/NewComponent&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>

<h4 id="b-属性代理-通过refs获取组件实例"><a href="#b-属性代理-通过refs获取组件实例" class="headerlink" title="b) 属性代理-通过refs获取组件实例"></a>b) 属性代理-通过refs获取组件实例</h4><p>当我们包装WrappedComponent的时候，想获取到它的实例怎么办，可以通过引用(ref),在WrappedComponent组件挂载的时候，会执行ref的回调函数，在hoc中取到组件的实例。通过打印可以看到它的props、 state、方法都是可以取到的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  say()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"say say say ....."</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello React &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">//此处的instance会拿到被包装的组件实例，然后访问被包装的组件对象的属性和方法</span></span><br><span class="line">    proc(instance) &#123;</span><br><span class="line">      instance.say();</span><br><span class="line">      <span class="built_in">console</span>.log(instance.props.name)</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125; <span class="attr">ref</span>=<span class="string">&#123;this.proc&#125;</span> /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NewComponent = HocComponent(MyComponent)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;NewComponent name=<span class="string">"zhangsan"</span>&gt;&lt;<span class="regexp">/NewComponent&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>

<h4 id="c-属性代理-抽取state"><a href="#c-属性代理-抽取state" class="headerlink" title="c) 属性代理-抽取state"></a>c) 属性代理-抽取state</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      value:<span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  handleChange(event)&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      value:event.target.value</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;this.state.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTextArea</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      value:<span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  handleChange(event)&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      value:event.target.value</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">value</span>=<span class="string">&#123;this.state.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span>/&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NewInput = HocComponent(MyInput)</span><br><span class="line"><span class="keyword">const</span> NewTextArea = HocComponent(MyTextArea)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;NewInput&gt;&lt;<span class="regexp">/NewInput&gt;</span></span><br><span class="line"><span class="regexp">      &lt;NewTextArea&gt;&lt;/</span>NewTextArea&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/这边代码存在的问题：MyInput和MyTextArea组件都有自己的state和change方法，代码重用性太大</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;this.props.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.props.onChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTextArea</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">value</span>=<span class="string">&#123;this.props.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.props.onChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">//将所有被包含组件的state和change都抽取到高阶组件中</span></span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">      <span class="keyword">super</span>(props);</span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        value: <span class="string">""</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.handleChange = <span class="keyword">this</span>.handleChange.bind(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    handleChange(event) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        value: event.target.value</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> newProps = &#123;</span><br><span class="line">        value: <span class="keyword">this</span>.state.value,</span><br><span class="line">        onChange: <span class="keyword">this</span>.handleChange</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="comment">//向被包含组件传递属性</span></span><br><span class="line">        &lt;WrappedComponent &#123;...this.props&#125; &#123;...newProps&#125; /&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NewInput = HocComponent(MyInput)</span><br><span class="line"><span class="keyword">const</span> NewTextArea = HocComponent(MyTextArea)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;NewInput&gt;&lt;<span class="regexp">/NewInput&gt;</span></span><br><span class="line"><span class="regexp">      &lt;NewTextArea&gt;&lt;/</span>NewTextArea&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>

<h4 id="d-属性代理-用其他元素包装组件"><a href="#d-属性代理-用其他元素包装组件" class="headerlink" title="d) 属性代理-用其他元素包装组件"></a>d) 属性代理-用其他元素包装组件</h4><p>为了封装样式、布局或别的目的，可以用其它组件和元素包裹 WrappedComponent。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>被包裹组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div style=&#123;&#123;<span class="attr">color</span>:<span class="string">"red"</span>&#125;&#125;&gt;</span><br><span class="line">          &lt;WrappedComponent &#123;...this.props&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const NewComponent = HocComponent(MyComponent)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function App() &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;NewComponent&gt;&lt;/</span>NewComponent&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>

<h3 id="11-2-2-高阶组件的实现方式-反向继承"><a href="#11-2-2-高阶组件的实现方式-反向继承" class="headerlink" title="11.2.2 高阶组件的实现方式-反向继承"></a>11.2.2 高阶组件的实现方式-反向继承</h3><p>反向继承( Inheritance Inversion )：返回的 HOC 类（Enhancer）继承了 WrappedComponent。之所以被称为 Inheritance Inversion 是因为 WrappedComponent 被 Enhancer 继承了，而不是 WrappedComponent 继承了 Enhancer。在这种方式中，它们的关系看上去被反转（inverse）了。</p>
<p>通过继承WrappedComponent，除了一些静态方法，包括生命周期，state，各种function，我们都可以得到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iiHOC</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Enhancer</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">super</span>.render()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反向继承的作用：</p>
<ul>
<li>渲染劫持</li>
<li>操作state</li>
</ul>
<h4 id="a-反向继承-渲染劫持"><a href="#a-反向继承-渲染劫持" class="headerlink" title="a) 反向继承-渲染劫持"></a>a) 反向继承-渲染劫持</h4><p>之所以被称为渲染劫持是因为 HOC 控制着 WrappedComponent 的渲染输出，可以用它做各种各样的事。通过渲染劫持可以：</p>
<ul>
<li>在由 render输出的任何 React 元素中读取、添加、编辑、删除 props</li>
<li>读取和修改由 render 输出的 React 元素树</li>
<li>有条件地渲染元素树</li>
<li>把样式包裹进元素树（就像在 Props Proxy 中的那样）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">name</span>=<span class="string">"pp"</span>&gt;</span>被包裹组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iiHOC</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Enhancer</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> elementsTree = <span class="keyword">super</span>.render();</span><br><span class="line">      <span class="comment">//打印父组件的属性值</span></span><br><span class="line">      <span class="built_in">console</span>.log(elementsTree.props)</span><br><span class="line">      <span class="comment">//添加新的 属性返回</span></span><br><span class="line">      <span class="keyword">let</span> newProps = &#123;<span class="attr">style</span>:&#123;<span class="attr">color</span>:<span class="string">'red'</span>&#125;&#125;;</span><br><span class="line">      <span class="keyword">const</span> props = <span class="built_in">Object</span>.assign(&#123;&#125;,elementsTree.props,newProps);</span><br><span class="line">      <span class="keyword">const</span> newElement = React.cloneElement(elementsTree, props, elementsTree.props.children)</span><br><span class="line">      <span class="keyword">return</span> newElement;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NewComponent = iiHOC(MyComponent)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;NewComponent&gt;&lt;<span class="regexp">/NewComponent&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<h4 id="b-反向继承-修改state"><a href="#b-反向继承-修改state" class="headerlink" title="b) 反向继承-修改state"></a>b) 反向继承-修改state</h4><p>HOC 可以读取、编辑和删除 WrappedComponent 实例的 state，如果需要，也可以给它添加更多的 state。但是这会搞乱 WrappedComponent 的 state，可能会导致破坏某些东西，通常不建议使用高阶组件修改添加state。</p>
<p>下面通过访问 WrappedComponent 的 props 和 state 来做测试。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">IIHOCDEBUGGER</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">II</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;h2&gt;HOC Debugger Component&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">          &lt;p&gt;Props&lt;/</span>p&gt; <span class="xml"><span class="tag">&lt;<span class="name">pre</span>&gt;</span>&#123;JSON.stringify(this.props)&#125;<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br><span class="line">          &lt;p&gt;State&lt;<span class="regexp">/p&gt;&lt;pre&gt;&#123;JSON.stringify(this.state)&#125;&lt;/</span>pre&gt;</span><br><span class="line">          &#123;<span class="keyword">super</span>.render()&#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="12-相关文章"><a href="#12-相关文章" class="headerlink" title="12. 相关文章"></a>12. 相关文章</h1><ul>
<li><a href="https://mp.weixin.qq.com/s/gV-w_rRfdBVAqsOpBGZaVw" target="_blank" rel="noopener">2018 年，React 将独占前端框架鳌头？</a></li>
<li><a href="https://mp.weixin.qq.com/s/0wXWqKIigaKzMSfy4vJMVw" target="_blank" rel="noopener">前端框架三巨头年度走势对比：Vue 增长率最高</a></li>
</ul>
<ul>
<li><a href="http://www.cnblogs.com/tim100/p/6050514.html" target="_blank" rel="noopener">React数据流和组件间的沟通总结</a></li>
<li><a href="https://segmentfault.com/q/1010000005876655/a-1020000005876751" target="_blank" rel="noopener">单向数据流和双向绑定各有什么优缺点？</a></li>
<li><a href="https://www.zhihu.com/question/29504639?sort=created" target="_blank" rel="noopener">怎么更好的理解虚拟DOM?</a></li>
<li><a href="http://www.css88.com/react/index.html" target="_blank" rel="noopener">React中文文档 - 版本较低</a></li>
<li><a href="http://blog.csdn.net/yczz/article/details/49886061" target="_blank" rel="noopener">React 源码剖析系列 － 不可思议的 react diff</a></li>
<li><a href="http://www.infoq.com/cn/articles/react-dom-diff?from=timeline&isappinstalled=0" target="_blank" rel="noopener">深入浅出React（四）：虚拟DOM Diff算法解析</a></li>
<li><a href="http://www.cocoachina.com/webapp/20150721/12692.html" target="_blank" rel="noopener">一看就懂的ReactJs入门教程（精华版）</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/06/css_modules.html" target="_blank" rel="noopener">CSS Modules 用法教程</a></li>
<li><a href="http://blog.csdn.net/itzhongzi/article/details/66045880" target="_blank" rel="noopener">将MarkDown转换为HTML页面</a></li>
<li><a href="https://jingyan.baidu.com/article/0320e2c1c9cf0e1b87507b26.html" target="_blank" rel="noopener">win7命令行 端口占用 查询进程号 杀进程</a></li>
<li><a href="https://facebook.github.io/react/docs/typechecking-with-proptypes.html" target="_blank" rel="noopener">类型校验</a></li>
</ul>
<ul>
<li><a href="https://reactjs.org/docs/animation.html#high-level-api-reactcsstransitiongroup" target="_blank" rel="noopener">Animation Add-Ons</a></li>
</ul>
<h2 id="安装-React-Developer-Tools-调试工具"><a href="#安装-React-Developer-Tools-调试工具" class="headerlink" title="安装 React Developer Tools 调试工具"></a>安装 React Developer Tools 调试工具</h2><p><a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=zh-CN" target="_blank" rel="noopener">React Developer Tools - Chrome 扩展下载安装地址</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小逸</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/09/27/React/">http://yoursite.com/2019/09/27/React/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">小逸的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1588051543473&amp;di=67f191093aa1a813125aa3036b4aaf85&amp;imgtype=0&amp;src=http%3A%2F%2Fimg0.imgtn.bdimg.com%2Fit%2Fu%3D2340366615%2C2853341379%26fm%3D214%26gp%3D0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/10/20/Create-React-App/"><img class="prev_cover lazyload" data-src="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2035944494,3453366933&amp;fm=26&amp;gp=0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Create-React-App</div></div></a></div><div class="next-post pull_right"><a href="/2019/09/06/Vue/"><img class="next_cover lazyload" data-src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1588051991385&amp;di=3dfd224a522abdec49c104c4b80c794d&amp;imgtype=0&amp;src=http%3A%2F%2Fzbjquan.zbjimg.com%2Fforum%2F7niu%2F201809%2F28%2F175317az6j6wxrjsej171j.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue</div></div></a></div></nav></article></main><footer id="footer" style="background-image: url(https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2035944494,3453366933&amp;fm=26&amp;gp=0.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By 小逸</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>